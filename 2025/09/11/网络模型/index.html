<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-bounce.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="1. Kubernetes CNI ç½‘ç»œæ¨¡å‹ç®€ä»‹K8s çš„ç½‘ç»œæ¨¡å‹æ ¸å¿ƒè¦æ±‚ï¼š  Pod-to-Pod äº’é€šï¼šæ¯ä¸ª Pod éƒ½æœ‰å”¯ä¸€ IPï¼ŒPod ä¹‹é—´ä¸éœ€è¦ NAT å°±èƒ½é€šä¿¡ã€‚ Pod-to-Service äº’é€šï¼šé€šè¿‡ Service ClusterIP æˆ–è€… kube-proxy&#x2F;ipvs å®ç°ã€‚ è·¨èŠ‚ç‚¹é€šä¿¡ï¼šä¸åŒ Node ä¸Šçš„ Pod å¿…é¡»èƒ½ç›´æ¥é€šä¿¡ã€‚  CNIï¼ˆContainer">
<meta property="og:type" content="article">
<meta property="og:title" content="ç½‘ç»œæ¨¡å‹">
<meta property="og:url" content="http://example.com/2025/09/11/%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/index.html">
<meta property="og:site_name" content="Hui&#39;s Blog">
<meta property="og:description" content="1. Kubernetes CNI ç½‘ç»œæ¨¡å‹ç®€ä»‹K8s çš„ç½‘ç»œæ¨¡å‹æ ¸å¿ƒè¦æ±‚ï¼š  Pod-to-Pod äº’é€šï¼šæ¯ä¸ª Pod éƒ½æœ‰å”¯ä¸€ IPï¼ŒPod ä¹‹é—´ä¸éœ€è¦ NAT å°±èƒ½é€šä¿¡ã€‚ Pod-to-Service äº’é€šï¼šé€šè¿‡ Service ClusterIP æˆ–è€… kube-proxy&#x2F;ipvs å®ç°ã€‚ è·¨èŠ‚ç‚¹é€šä¿¡ï¼šä¸åŒ Node ä¸Šçš„ Pod å¿…é¡»èƒ½ç›´æ¥é€šä¿¡ã€‚  CNIï¼ˆContainer">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-09-11T12:32:34.000Z">
<meta property="article:modified_time" content="2025-09-11T14:17:45.518Z">
<meta property="article:author" content="å…­ä¸€">
<meta property="article:tag" content="è¿ç»´">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2025/09/11/%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>ç½‘ç»œæ¨¡å‹ | Hui's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hui's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Code Life</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/11/%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="å…­ä¸€">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hui's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ç½‘ç»œæ¨¡å‹
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-11 20:32:34 / ä¿®æ”¹æ—¶é—´ï¼š22:17:45" itemprop="dateCreated datePublished" datetime="2025-09-11T20:32:34+08:00">2025-09-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">åŸºç¡€çŸ¥è¯†</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
              <span>5.1k</span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
              <span>5 åˆ†é’Ÿ</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="1-Kubernetes-CNI-ç½‘ç»œæ¨¡å‹ç®€ä»‹"><a href="#1-Kubernetes-CNI-ç½‘ç»œæ¨¡å‹ç®€ä»‹" class="headerlink" title="1. Kubernetes CNI ç½‘ç»œæ¨¡å‹ç®€ä»‹"></a>1. Kubernetes CNI ç½‘ç»œæ¨¡å‹ç®€ä»‹</h2><p>K8s çš„ç½‘ç»œæ¨¡å‹æ ¸å¿ƒè¦æ±‚ï¼š</p>
<ol>
<li><strong>Pod-to-Pod äº’é€š</strong>ï¼šæ¯ä¸ª Pod éƒ½æœ‰å”¯ä¸€ IPï¼ŒPod ä¹‹é—´ä¸éœ€è¦ NAT å°±èƒ½é€šä¿¡ã€‚</li>
<li><strong>Pod-to-Service äº’é€š</strong>ï¼šé€šè¿‡ Service ClusterIP æˆ–è€… kube-proxy&#x2F;ipvs å®ç°ã€‚</li>
<li><strong>è·¨èŠ‚ç‚¹é€šä¿¡</strong>ï¼šä¸åŒ Node ä¸Šçš„ Pod å¿…é¡»èƒ½ç›´æ¥é€šä¿¡ã€‚</li>
</ol>
<p>CNIï¼ˆContainer Network Interfaceï¼‰æ˜¯ä¸€å¥—æ ‡å‡†ï¼ŒK8s é€šè¿‡è°ƒç”¨ä¸åŒçš„ CNI æ’ä»¶æ¥å®ç°å…·ä½“çš„ç½‘ç»œã€‚</p>
<hr>
<h2 id="2-Flannel"><a href="#2-Flannel" class="headerlink" title="2. Flannel"></a>2. Flannel</h2><p>ğŸ”¹ <strong>å®šä½</strong>ï¼šæœ€æ—©ã€æœ€ç®€å•çš„ CNIï¼Œä¸»è¦å®ç° <strong>Pod-to-Pod çš„ä¸‰å±‚ç½‘ç»œè¿é€šæ€§</strong>ã€‚<br> ğŸ”¹ <strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æä¾› Overlay ç½‘ç»œï¼ˆVXLANã€UDPã€Host-GW ç­‰æ¨¡å¼ï¼‰ã€‚</li>
<li><strong>åªç®¡è¿é€šæ€§</strong>ï¼Œä¸æä¾› NetworkPolicyï¼ˆå®‰å…¨ç­–ç•¥ï¼‰ã€‚</li>
<li>æ¶æ„ç®€å•ã€æ˜“äºéƒ¨ç½²ï¼Œé€‚åˆå°è§„æ¨¡æˆ–å¯¹ç½‘ç»œå®‰å…¨éœ€æ±‚ä¸é«˜çš„åœºæ™¯ã€‚</li>
</ul>
<p>âœ… ä¼˜ç‚¹ï¼š</p>
<ul>
<li>éƒ¨ç½²ç®€å•ï¼Œç¨³å®šæˆç†Ÿã€‚</li>
<li>å ç”¨èµ„æºå°‘ã€‚</li>
</ul>
<p>âŒ ç¼ºç‚¹ï¼š</p>
<ul>
<li>åŠŸèƒ½å•ä¸€ï¼Œæ— å®‰å…¨ç­–ç•¥æ”¯æŒã€‚</li>
<li>æ€§èƒ½ä¸€èˆ¬ï¼ˆOverlay ä¼šå¸¦æ¥é¢å¤–å¼€é”€ï¼‰ã€‚</li>
</ul>
<hr>
<h2 id="3-Calico"><a href="#3-Calico" class="headerlink" title="3. Calico"></a>3. Calico</h2><p>ğŸ”¹ <strong>å®šä½</strong>ï¼šåŠŸèƒ½å…¨é¢çš„ CNIï¼Œæ”¯æŒ <strong>ä¸‰å±‚è·¯ç”± + å®‰å…¨ç­–ç•¥</strong>ã€‚<br> ğŸ”¹ <strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>é»˜è®¤é‡‡ç”¨ BGPï¼ˆè¾¹ç•Œç½‘å…³åè®®ï¼‰åšä¸‰å±‚è·¯ç”±ï¼ŒPod IP å¯ä»¥ç›´æ¥åœ¨èŠ‚ç‚¹é—´è·¯ç”±ï¼Œä¸ä¸€å®šè¦ overlayã€‚</li>
<li>æ”¯æŒ <strong>ç½‘ç»œç­–ç•¥ï¼ˆNetworkPolicyï¼‰</strong>ï¼ŒåŸºäº iptables æˆ– eBPF å®ç°å®‰å…¨éš”ç¦»ã€‚</li>
<li>æ—¢å¯ä»¥ Overlayï¼ˆIP-in-IPã€VXLANï¼‰ï¼Œä¹Ÿå¯ä»¥çº¯ä¸‰å±‚ï¼ˆDirect Routingï¼‰ã€‚</li>
</ul>
<p>âœ… ä¼˜ç‚¹ï¼š</p>
<ul>
<li>é«˜æ€§èƒ½ï¼ˆBGP ç›´è¿æ—¶å‡ ä¹æ— å°è£…å¼€é”€ï¼‰ã€‚</li>
<li>å®Œæ•´çš„ç½‘ç»œç­–ç•¥æ”¯æŒã€‚</li>
<li>ç”Ÿäº§ç¯å¢ƒåº”ç”¨å¹¿æ³›ï¼Œç¤¾åŒºæ´»è·ƒã€‚</li>
</ul>
<p>âŒ ç¼ºç‚¹ï¼š</p>
<ul>
<li>é…ç½®æ¯” Flannel å¤æ‚ã€‚</li>
<li>BGP é…ç½®å’Œå¤§è§„æ¨¡é›†ç¾¤ä¸‹è·¯ç”±æ”¶æ•›å¯èƒ½éœ€è¦è°ƒä¼˜ã€‚</li>
</ul>
<hr>
<h2 id="4-Cilium"><a href="#4-Cilium" class="headerlink" title="4. Cilium"></a>4. Cilium</h2><p>ğŸ”¹ <strong>å®šä½</strong>ï¼šæ–°ä¸€ä»£åŸºäº <strong>eBPF</strong> çš„ CNI æ’ä»¶ã€‚<br> ğŸ”¹ <strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ Linux eBPF æŠ€æœ¯å®ç°é«˜æ€§èƒ½æ•°æ®é¢ï¼Œæ›¿ä»£ iptablesã€‚</li>
<li>æ”¯æŒ <strong>L3&#x2F;L4&#x2F;L7 ç½‘ç»œç­–ç•¥</strong>ï¼ˆåº”ç”¨å±‚å¯è§æ€§ï¼Œç”šè‡³èƒ½åŸºäº HTTP æ–¹æ³•åšç­–ç•¥ï¼‰ã€‚</li>
<li>å¯ä»¥ä¸ Envoy é›†æˆï¼Œå…·å¤‡ Service Mesh èƒ½åŠ›ï¼ˆCilium Service Meshï¼‰ã€‚</li>
<li>æ”¯æŒ Overlayï¼ˆVXLANã€Geneveï¼‰å’Œç›´è¿è·¯ç”±æ¨¡å¼ã€‚</li>
</ul>
<p>âœ… ä¼˜ç‚¹ï¼š</p>
<ul>
<li>é«˜æ€§èƒ½ï¼ˆeBPF å†…æ ¸æ€è½¬å‘æ¯” iptables æ›´å¿«ï¼‰ã€‚</li>
<li>å®‰å…¨ç­–ç•¥æ›´ç»†ç²’åº¦ï¼ˆL7ï¼‰ã€‚</li>
<li>å¯è§‚æµ‹æ€§å¼ºï¼ˆå†…ç½® Hubbleï¼Œå¯è§‚å¯Ÿ Pod é—´æµé‡ï¼‰ã€‚</li>
<li>äº‘åŸç”Ÿæ–¹å‘æ›´å…ˆè¿›ï¼ˆå¯æ›¿ä»£éƒ¨åˆ† Service Mesh åŠŸèƒ½ï¼‰ã€‚</li>
</ul>
<p>âŒ ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¯¹å†…æ ¸è¦æ±‚è¾ƒé«˜ï¼ˆLinux å†…æ ¸ 4.9+ï¼Œæ¨è 5.x ä»¥ä¸Šï¼‰ã€‚</li>
<li>éƒ¨ç½²å’Œè°ƒè¯•å¤æ‚åº¦æ¯” Flannel é«˜ã€‚</li>
<li>å¯¹èµ„æºå¼€é”€ç›¸å¯¹æ¯” Flannel å¤§ã€‚</li>
</ul>
<hr>
<h2 id="5-ä¸‰è€…å¯¹æ¯”æ€»ç»“"><a href="#5-ä¸‰è€…å¯¹æ¯”æ€»ç»“" class="headerlink" title="5. ä¸‰è€…å¯¹æ¯”æ€»ç»“"></a>5. ä¸‰è€…å¯¹æ¯”æ€»ç»“</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>Flannel</th>
<th>Calico</th>
<th>Cilium</th>
</tr>
</thead>
<tbody><tr>
<td>æ ¸å¿ƒåŠŸèƒ½</td>
<td>Pod ç½‘ç»œè¿é€š</td>
<td>ç½‘ç»œè¿é€š + ç½‘ç»œç­–ç•¥ï¼ˆL3&#x2F;L4ï¼‰</td>
<td>ç½‘ç»œè¿é€š + L3&#x2F;L4&#x2F;L7 ç½‘ç»œç­–ç•¥</td>
</tr>
<tr>
<td>æ•°æ®å¹³é¢</td>
<td>VXLAN&#x2F;IP-in-IP</td>
<td>BGP &#x2F; VXLAN &#x2F; IP-in-IP</td>
<td>eBPFï¼ˆVXLAN&#x2F;Geneve&#x2F;ç›´è¿ï¼‰</td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>ä¸­ç­‰ï¼ˆOverlayï¼‰</td>
<td>é«˜ï¼ˆç›´è¿ BGP æ¨¡å¼ï¼‰</td>
<td>é«˜ï¼ˆeBPF å†…æ ¸è½¬å‘ï¼‰</td>
</tr>
<tr>
<td>ç½‘ç»œç­–ç•¥</td>
<td>âŒ ä¸æ”¯æŒ</td>
<td>âœ… æ”¯æŒ</td>
<td>âœ… æ›´ç»†ç²’åº¦ï¼ˆæ”¯æŒ L7ï¼‰</td>
</tr>
<tr>
<td>éƒ¨ç½²å¤æ‚åº¦</td>
<td>â­ æœ€ä½</td>
<td>â­â­ ä¸­ç­‰</td>
<td>â­â­â­ è¾ƒé«˜</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>å°è§„æ¨¡ã€ç®€å•é›†ç¾¤</td>
<td>ç”Ÿäº§ç¯å¢ƒä¸»æµã€å®‰å…¨éš”ç¦»éœ€æ±‚å¼º</td>
<td>å¯¹æ€§èƒ½&#x2F;å¯è§‚æµ‹æ€§è¦æ±‚é«˜çš„æ–°é¡¹ç›®</td>
</tr>
</tbody></table>
<p>å¥½çš„ ğŸ‘ æˆ‘æ¥ç»™ä½ ç³»ç»Ÿè®²ä¸€ä¸‹ <strong>Kubernetes CNIï¼ˆContainer Network Interfaceï¼‰å·¥ä½œåŸç†</strong>ï¼ŒåŒ…æ‹¬å®ƒçš„æµç¨‹å’Œåœ¨ K8s é‡Œçš„ä½œç”¨ã€‚</p>
<hr>
<h2 id="1-CNI-çš„èƒŒæ™¯"><a href="#1-CNI-çš„èƒŒæ™¯" class="headerlink" title="1. CNI çš„èƒŒæ™¯"></a>1. CNI çš„èƒŒæ™¯</h2><ul>
<li><strong>Kubernetes è‡ªèº«ä¸æä¾›å…·ä½“çš„ç½‘ç»œå®ç°</strong>ï¼Œå®ƒåªå®šä¹‰äº†ç½‘ç»œæ¨¡å‹è¦æ±‚ï¼ˆPod äº’é€šã€Pod ä¸ Service äº’é€šç­‰ï¼‰ã€‚</li>
<li>çœŸæ­£å®ç° Pod ç½‘ç»œçš„æ˜¯ <strong>CNI æ’ä»¶</strong>ï¼ˆä¾‹å¦‚ Flannelã€Calicoã€Ciliumï¼‰ã€‚</li>
<li><strong>CNI æ˜¯ CNCF å®šä¹‰çš„ä¸€å¥—æ ‡å‡†æ¥å£</strong>ï¼Œä»»ä½•ç½‘ç»œæ’ä»¶åªè¦éµå¾ªè¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥å’Œ K8s æ— ç¼é›†æˆã€‚</li>
</ul>
<hr>
<h2 id="2-CNI-çš„å·¥ä½œæµç¨‹"><a href="#2-CNI-çš„å·¥ä½œæµç¨‹" class="headerlink" title="2. CNI çš„å·¥ä½œæµç¨‹"></a>2. CNI çš„å·¥ä½œæµç¨‹</h2><p>å½“ Kubernetes åœ¨æŸä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»º Pod æ—¶ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>Kubelet è°ƒç”¨ CRIï¼ˆContainer Runtime Interfaceï¼‰</strong><ul>
<li>Pod åˆ›å»ºæ—¶ï¼ŒKubelet é€šçŸ¥å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ containerdã€CRI-Oã€Docker-shimï¼‰ã€‚</li>
</ul>
</li>
<li><strong>å®¹å™¨è¿è¡Œæ—¶è°ƒç”¨ CNI æ’ä»¶</strong><ul>
<li>å®¹å™¨è¿è¡Œæ—¶éœ€è¦ä¸ºå®¹å™¨é…ç½®ç½‘ç»œï¼ˆåˆ†é… IPã€è·¯ç”±ã€DNS ç­‰ï¼‰ã€‚</li>
<li>å®ƒä¼šæ ¹æ® <code>/etc/cni/net.d/</code> ä¸‹çš„ CNI é…ç½®æ–‡ä»¶ï¼Œè°ƒç”¨å¯¹åº”çš„ CNI æ’ä»¶ï¼ˆå¯æ‰§è¡ŒäºŒè¿›åˆ¶ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>CNI æ’ä»¶æ‰§è¡Œ <code>ADD</code> æ“ä½œ</strong><ul>
<li>æ’ä»¶ä¼šåˆ›å»ºä¸€ä¸ª <strong>veth pairï¼ˆè™šæ‹Ÿç½‘å¡å¯¹ï¼‰</strong>ï¼šä¸€ç«¯æ”¾åœ¨ Pod çš„ network namespaceï¼Œå¦ä¸€ç«¯æ¥åˆ°ä¸»æœºçš„ bridge æˆ–è·¯ç”±è®¾å¤‡ä¸Šã€‚</li>
<li>æ’ä»¶å‘ IPAMï¼ˆIP Address Managementï¼‰æ¨¡å—ç”³è¯·ä¸€ä¸ª IP åœ°å€ï¼Œåˆ†é…ç»™ Podã€‚</li>
<li>é…ç½®è·¯ç”±ï¼Œä½¿å¾— Pod å¯ä»¥è®¿é—®é›†ç¾¤å†…å¤–ç½‘ç»œã€‚</li>
</ul>
</li>
<li><strong>Pod ç½‘ç»œå»ºç«‹å®Œæˆ</strong><ul>
<li>Pod è·å¾— IP åœ°å€å’Œè·¯ç”±è¡¨ï¼Œå¯ä»¥ä¸åŒèŠ‚ç‚¹ã€è·¨èŠ‚ç‚¹çš„ Pod é€šä¿¡ã€‚</li>
<li>è·¨èŠ‚ç‚¹æ—¶ï¼ŒCNI æ’ä»¶ï¼ˆå¦‚ Flannel VXLANã€Calico BGPã€Cilium eBPFï¼‰è´Ÿè´£æŠŠæµé‡æ­£ç¡®è½¬å‘åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚</li>
</ul>
</li>
<li><strong>Pod åˆ é™¤æ—¶è°ƒç”¨ <code>DEL</code> æ“ä½œ</strong><ul>
<li>å®¹å™¨è¿è¡Œæ—¶è°ƒç”¨æ’ä»¶ <code>DEL</code>ï¼Œé‡Šæ”¾ Pod çš„ IPï¼Œæ¸…ç†ç½‘ç»œè®¾å¤‡ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h2 id="3-CNI-æ’ä»¶æ¥å£è§„èŒƒ"><a href="#3-CNI-æ’ä»¶æ¥å£è§„èŒƒ" class="headerlink" title="3. CNI æ’ä»¶æ¥å£è§„èŒƒ"></a>3. CNI æ’ä»¶æ¥å£è§„èŒƒ</h2><p>CNI æ’ä»¶å¿…é¡»å®ç°çš„äºŒè¿›åˆ¶æ¥å£åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>ADD</strong>ï¼šåˆ›å»ºç½‘ç»œæ¥å£ï¼Œåˆ†é… IP åœ°å€ã€‚</li>
<li><strong>DEL</strong>ï¼šåˆ é™¤ç½‘ç»œæ¥å£ï¼Œé‡Šæ”¾ IPã€‚</li>
<li><strong>CHECK</strong>ï¼ˆå¯é€‰ï¼‰ï¼šæ£€æŸ¥ç½‘ç»œæ˜¯å¦æ­£å¸¸ã€‚</li>
<li><strong>VERSION</strong>ï¼šè¿”å›æ’ä»¶æ”¯æŒçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</li>
</ul>
<p>è¾“å…¥ï¼šé€šè¿‡æ ‡å‡†è¾“å…¥ä¼ é€’ JSON é…ç½®ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;cniVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.4.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mynet&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bridge&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;bridge&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cni0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;isGateway&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ipam&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;host-local&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;subnet&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.244.0.0/16&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼šæ’ä»¶è¿”å› Pod çš„ IP ä¿¡æ¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;cniVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.4.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ips&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.244.0.5/24&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gateway&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.244.0.1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-CNI-åœ¨-Kubernetes-ä¸­çš„ä½œç”¨"><a href="#4-CNI-åœ¨-Kubernetes-ä¸­çš„ä½œç”¨" class="headerlink" title="4. CNI åœ¨ Kubernetes ä¸­çš„ä½œç”¨"></a>4. CNI åœ¨ Kubernetes ä¸­çš„ä½œç”¨</h2><ul>
<li><strong>Pod ç½‘ç»œæ¥å…¥</strong>ï¼šä¸ºæ¯ä¸ª Pod åˆ†é…ç‹¬ç«‹ IPï¼Œå¹¶ä¸å®¿ä¸»æœºç½‘ç»œäº’é€šã€‚</li>
<li><strong>è·¨èŠ‚ç‚¹é€šä¿¡</strong>ï¼šå†³å®š Pod è·¨èŠ‚ç‚¹å¦‚ä½•è½¬å‘ï¼ˆVXLANã€BGPã€eBPF ç­‰ï¼‰ã€‚</li>
<li><strong>ç½‘ç»œç­–ç•¥</strong>ï¼šéƒ¨åˆ† CNI æ’ä»¶ï¼ˆCalicoã€Ciliumï¼‰å®ç° K8s çš„ <code>NetworkPolicy</code>ï¼Œç”¨äºå®‰å…¨éš”ç¦»ã€‚</li>
</ul>
<hr>
<h2 id="5-ç®€åŒ–å›¾ç¤º"><a href="#5-ç®€åŒ–å›¾ç¤º" class="headerlink" title="5. ç®€åŒ–å›¾ç¤º"></a>5. ç®€åŒ–å›¾ç¤º</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">        Kubelet</span><br><span class="line">           â”‚</span><br><span class="line">           â–¼</span><br><span class="line">    Container Runtime</span><br><span class="line">           â”‚</span><br><span class="line">           â–¼</span><br><span class="line">      è°ƒç”¨ <span class="built_in">CNI</span> æ’ä»¶</span><br><span class="line">           â”‚</span><br><span class="line">   â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">   â”‚                 â”‚</span><br><span class="line"><span class="built_in">CNI</span> ç½‘ç»œæ’ä»¶   IPAM æ’ä»¶</span><br><span class="line">   â”‚                 â”‚</span><br><span class="line">   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">           â”‚</span><br><span class="line">   é…ç½® Pod veth + IP</span><br><span class="line">           â”‚</span><br><span class="line">           â–¼</span><br><span class="line">        Pod è·å¾—ç½‘ç»œ</span><br></pre></td></tr></table></figure>

<p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥æ·±å…¥è®²è§£ä¸€ä¸‹ <strong>Cilium çš„ Native Routing with kube-proxy æ¨¡å¼</strong>ã€‚</p>
<hr>
<h2 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1. èƒŒæ™¯"></a>1. èƒŒæ™¯</h2><p>Cilium æ˜¯ä¸€ä¸ªåŸºäº <strong>eBPF</strong> çš„ CNI æ’ä»¶ï¼Œæ”¯æŒå¤šç§æ•°æ®è·¯å¾„æ¨¡å¼ï¼Œå…¶ä¸­å¸¸è§çš„æœ‰ï¼š</p>
<ul>
<li><strong>Overlay æ¨¡å¼</strong>ï¼ˆVXLAN&#x2F;Geneveï¼‰ï¼šæµé‡å°è£…ååœ¨èŠ‚ç‚¹ä¹‹é—´ä¼ é€’ã€‚</li>
<li><strong>Native Routing æ¨¡å¼</strong>ï¼ˆç›´è¿è·¯ç”±ï¼‰ï¼šåˆ©ç”¨èŠ‚ç‚¹è·¯ç”±è¡¨è½¬å‘ï¼Œä¸åšå°è£…ï¼Œæ€§èƒ½æ›´é«˜ã€‚</li>
</ul>
<p>åŒæ—¶ï¼ŒK8s é»˜è®¤çš„ <strong>Service è½¬å‘</strong>æ˜¯ç”± <strong>kube-proxy</strong>ï¼ˆåŸºäº iptables æˆ– ipvsï¼‰å®ç°çš„ã€‚ä½† Cilium ä¹Ÿå¯ä»¥å®Œå…¨æ¥ç®¡ Service è½¬å‘ï¼ˆæ›¿ä»£ kube-proxyï¼‰ï¼Œç§°ä¸º <strong>kube-proxy replacement</strong> æ¨¡å¼ã€‚</p>
<p>ä½ é—®çš„ <strong>Native Routing with kube-proxy æ¨¡å¼</strong>ï¼Œæ„æ€æ˜¯ï¼š<br> ğŸ‘‰ <strong>Cilium ä½¿ç”¨ Native Routing åš Pod-to-Pod æµé‡è½¬å‘ï¼ŒåŒæ—¶ Service è¿˜æ˜¯äº¤ç»™ kube-proxy å¤„ç†ã€‚</strong></p>
<hr>
<h2 id="2-å·¥ä½œåŸç†"><a href="#2-å·¥ä½œåŸç†" class="headerlink" title="2. å·¥ä½œåŸç†"></a>2. å·¥ä½œåŸç†</h2><h3 id="Pod-to-Pod-é€šä¿¡"><a href="#Pod-to-Pod-é€šä¿¡" class="headerlink" title="Pod-to-Pod é€šä¿¡"></a>Pod-to-Pod é€šä¿¡</h3><ol>
<li>Pod åœ¨èŠ‚ç‚¹ä¸Šåˆ†é…ä¸€ä¸ª <strong>çœŸå®çš„å­ç½‘ IP</strong>ï¼ˆæ²¡æœ‰ VXLAN å°è£…ï¼‰ã€‚</li>
<li>Cilium é…ç½® Linux è·¯ç”±è¡¨ï¼Œè®©ä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„ Pod ç½‘ç»œå¯ä»¥ç›´è¾¾ï¼š<ul>
<li>å¯ä»¥é€šè¿‡ <strong>BGP</strong>ï¼ˆCilium + MetalLB&#x2F;FRRï¼‰åŠ¨æ€åˆ†å‘è·¯ç”±ã€‚</li>
<li>æˆ–è€…é€šè¿‡é™æ€è·¯ç”±ï¼ˆcluster scope routingï¼‰ã€‚</li>
</ul>
</li>
<li>æ•°æ®åŒ…èµ°ä¸»æœºè·¯ç”±è½¬å‘ï¼Œç›´æ¥åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹çš„ Podï¼ˆæ— éš§é“å°è£… â†’ æ›´é«˜æ€§èƒ½ï¼‰ã€‚</li>
</ol>
<h3 id="Pod-to-Service-é€šä¿¡"><a href="#Pod-to-Service-é€šä¿¡" class="headerlink" title="Pod-to-Service é€šä¿¡"></a>Pod-to-Service é€šä¿¡</h3><ul>
<li>ä»ç”± <strong>kube-proxy</strong> è´Ÿè´£ Service çš„è™šæ‹Ÿ IP (ClusterIP) è½¬æ¢ã€‚</li>
<li>æµé‡åˆ°è¾¾ Service çš„è™šæ‹Ÿ IP åï¼Œé€šè¿‡ iptables&#x2F;ipvs è§„åˆ™ NAT åˆ°å¯¹åº” Podã€‚</li>
</ul>
<h3 id="ç®€å•ç¤ºæ„ï¼š"><a href="#ç®€å•ç¤ºæ„ï¼š" class="headerlink" title="ç®€å•ç¤ºæ„ï¼š"></a>ç®€å•ç¤ºæ„ï¼š</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[PodA]</span> <span class="built_in">--</span>(Native Routing)--&gt; <span class="selector-attr">[PodB]</span>         âœ… Cilium ç›´è¿è·¯ç”±</span><br><span class="line"><span class="selector-attr">[PodA]</span> <span class="built_in">--</span>(ClusterIP)--&gt; <span class="selector-attr">[kube-proxy]</span> --&gt; <span class="selector-attr">[PodB]</span>   âœ… kube-proxy NAT</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-æ¨¡å¼ç‰¹ç‚¹"><a href="#3-æ¨¡å¼ç‰¹ç‚¹" class="headerlink" title="3. æ¨¡å¼ç‰¹ç‚¹"></a>3. æ¨¡å¼ç‰¹ç‚¹</h2><p>âœ… <strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>æ€§èƒ½å¥½ï¼šPod-to-Pod æ— å°è£…ï¼Œå‡å°‘é¢å¤–å¼€é”€ã€‚</li>
<li>éƒ¨ç½²ç®€å•ï¼šä¸ç”¨ç«‹åˆ»æ›¿æ¢ kube-proxyï¼Œé™ä½æ¥å…¥é£é™©ã€‚</li>
<li>å…¼å®¹æ€§å¼ºï¼šService ç›¸å…³é€»è¾‘ä¿æŒä¸å˜ã€‚</li>
</ul>
<p>âŒ <strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>Service ä»ç„¶ä¾èµ– kube-proxyï¼ˆiptables&#x2F;ipvsï¼‰ï¼Œæ€§èƒ½å’Œå¯è§‚æµ‹æ€§ä¸å¦‚ Cilium eBPF Serviceã€‚</li>
<li>Native Routing éœ€è¦æ­£ç¡®é…ç½®è·¯ç”±ï¼ˆä¾‹å¦‚ BGP æˆ–é™æ€è·¯ç”±ï¼‰ï¼Œç½‘ç»œç¯å¢ƒå¤æ‚æ—¶é…ç½®é‡å¤§ã€‚</li>
</ul>
<hr>
<h2 id="4-é€‚ç”¨åœºæ™¯"><a href="#4-é€‚ç”¨åœºæ™¯" class="headerlink" title="4. é€‚ç”¨åœºæ™¯"></a>4. é€‚ç”¨åœºæ™¯</h2><ul>
<li>é›†ç¾¤è§„æ¨¡ä¸­ç­‰ï¼Œè¿½æ±‚ <strong>Pod-to-Pod é«˜æ€§èƒ½é€šä¿¡</strong>ï¼Œä½†ä¸æƒ³ç«‹å³æ›¿æ¢ kube-proxyã€‚</li>
<li>å·²ç»æœ‰ç°æˆçš„ kube-proxy é…ç½®ï¼Œè¿ç§»æˆæœ¬è¾ƒé«˜ã€‚</li>
<li>å¯¹ Service çš„æµé‡æ€§èƒ½è¦æ±‚ä¸æ˜¯ç“¶é¢ˆã€‚</li>
</ul>
<hr>
<h2 id="5-ä¸å…¶ä»–æ¨¡å¼å¯¹æ¯”"><a href="#5-ä¸å…¶ä»–æ¨¡å¼å¯¹æ¯”" class="headerlink" title="5. ä¸å…¶ä»–æ¨¡å¼å¯¹æ¯”"></a>5. ä¸å…¶ä»–æ¨¡å¼å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>Pod-to-Pod</th>
<th>Pod-to-Service</th>
<th>æ€§èƒ½</th>
<th>å¤æ‚åº¦</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Overlay + kube-proxy</strong></td>
<td>VXLAN&#x2F;Geneve å°è£…</td>
<td>kube-proxy</td>
<td>ä¸­</td>
<td>ä½</td>
</tr>
<tr>
<td><strong>Native Routing + kube-proxy</strong></td>
<td>ç›´è¿è·¯ç”±</td>
<td>kube-proxy</td>
<td>é«˜</td>
<td>ä¸­</td>
</tr>
<tr>
<td><strong>Overlay + eBPF (no kube-proxy)</strong></td>
<td>VXLAN&#x2F;Geneve å°è£…</td>
<td>Cilium eBPF</td>
<td>é«˜</td>
<td>ä¸­</td>
</tr>
<tr>
<td><strong>Native Routing + eBPF (no kube-proxy)</strong></td>
<td>ç›´è¿è·¯ç”±</td>
<td>Cilium eBPF</td>
<td>æœ€é«˜</td>
<td>é«˜</td>
</tr>
</tbody></table>
<hr>
<p>ğŸ‘‰ æ€»ç»“ä¸€å¥è¯ï¼š<br> <strong>Cilium Native Routing with kube-proxy æ¨¡å¼</strong>å°±æ˜¯ï¼š</p>
<ul>
<li><strong>Pod-to-Pod</strong> èµ°ç›´è¿è·¯ç”±ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰ã€‚</li>
<li><strong>Service</strong> è¿˜æ˜¯èµ° kube-proxyï¼ˆå…¼å®¹æ€§æœ€å¥½ï¼‰ã€‚</li>
<li>é€‚åˆä½œä¸ºä»ä¼ ç»Ÿæ–¹æ¡ˆé€æ­¥è¿ç§»åˆ° Cilium å…¨ eBPF çš„è¿‡æ¸¡é˜¶æ®µã€‚</li>
</ul>
<h2 id="Native-Routing-eBPF-hostRouting-æ¨¡å¼å·¥ä½œåŸç†"><a href="#Native-Routing-eBPF-hostRouting-æ¨¡å¼å·¥ä½œåŸç†" class="headerlink" title="Native Routing + eBPF hostRouting æ¨¡å¼å·¥ä½œåŸç†"></a>Native Routing + eBPF hostRouting æ¨¡å¼å·¥ä½œåŸç†</h2><p>åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼š</p>
<ul>
<li><strong>Pod-to-Pod è·¨èŠ‚ç‚¹é€šä¿¡</strong>ï¼š<ol>
<li>Pod å‘å‡ºæ•°æ®åŒ…ï¼ˆç›®çš„ IP &#x3D; PodB IPï¼‰ã€‚</li>
<li>Cilium çš„ eBPF ç¨‹åºåœ¨ veth ingress å¤„æ•è·æ•°æ®åŒ…ã€‚</li>
<li>eBPF æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œåˆ¤æ–­ç›®æ ‡ Pod åœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
<li>ç›´æ¥æŠŠæ•°æ®åŒ…é€åˆ°ç‰©ç†ç½‘å¡ï¼Œå¸¦ä¸Šç›®æ ‡ Node çš„ MAC åœ°å€ã€‚</li>
<li>ç›®æ ‡ Node æ”¶åˆ°åŒ…åï¼ŒCilium eBPF æŠŠå®ƒç›´æ¥é€å…¥ç›®æ ‡ Pod çš„ vethï¼Œä¸å†èµ°ä¸»æœºåè®®æ ˆã€‚</li>
</ol>
</li>
<li><strong>Pod-to-Service</strong>ï¼š<ul>
<li>å¦‚æœè¿˜ä¿ç•™ kube-proxyï¼Œåˆ™ç”± iptables&#x2F;ipvs å¤„ç†ã€‚</li>
<li>å¦‚æœå¼€å¯ Cilium kube-proxy replacementï¼Œåˆ™ç”± Cilium eBPF Service åŠ é€Ÿã€‚</li>
</ul>
</li>
</ul>
<h2 id="Cilium-VXLAN-æ¨¡å¼çš„å·¥ä½œåŸç†"><a href="#Cilium-VXLAN-æ¨¡å¼çš„å·¥ä½œåŸç†" class="headerlink" title="Cilium VXLAN æ¨¡å¼çš„å·¥ä½œåŸç†"></a>Cilium VXLAN æ¨¡å¼çš„å·¥ä½œåŸç†</h2><p>å½“ä½ åœ¨ Cilium é‡Œé€‰æ‹© VXLAN æ¨¡å¼æ—¶ï¼š</p>
<h3 id="Pod-to-Pod-æµé‡"><a href="#Pod-to-Pod-æµé‡" class="headerlink" title="Pod-to-Pod æµé‡"></a>Pod-to-Pod æµé‡</h3><ol>
<li><p>PodAï¼ˆåœ¨ Node1ï¼‰è¦è®¿é—® PodBï¼ˆåœ¨ Node2ï¼‰ã€‚</p>
</li>
<li><p>PodA å‘å‡ºçš„æ•°æ®åŒ…ç›®çš„ IP &#x3D; PodB IPã€‚</p>
</li>
<li><p>Cilium eBPF ç¨‹åºæ‹¦æˆªæ•°æ®åŒ… â†’ å°è£…ä¸º <strong>VXLAN åŒ…</strong>ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Outer</span> IP: Node1 IP â†’ Node2 IP</span><br><span class="line"><span class="keyword">Outer</span> UDP: dst=<span class="number">4789</span></span><br><span class="line">VXLAN <span class="keyword">Header</span></span><br><span class="line"><span class="keyword">Inner</span> Ethernet + <span class="keyword">Inner</span> IP: PodA â†’ PodB</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŒ…ç»è¿‡ç‰©ç†ç½‘ç»œåˆ°è¾¾ Node2ã€‚</p>
</li>
<li><p>Node2 çš„ Cilium VXLAN è§£å°è£…ï¼Œè¿˜åŸå‡º Pod-to-Pod åŸå§‹åŒ…ã€‚</p>
</li>
<li><p>äº¤ä»˜ç»™ PodBã€‚</p>
</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%BF%90%E7%BB%B4/" rel="tag"># è¿ç»´</a>
              <a href="/tags/k8s/" rel="tag"># k8s</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/09/11/%E8%81%9A%E5%90%88/" rel="prev" title="èšåˆ">
      <i class="fa fa-chevron-left"></i> èšåˆ
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/09/11/%E7%BD%91%E7%BB%9C%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/" rel="next" title="ç½‘ç»œå‘½åç©ºé—´">
      ç½‘ç»œå‘½åç©ºé—´ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Kubernetes-CNI-%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">1. Kubernetes CNI ç½‘ç»œæ¨¡å‹ç®€ä»‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Flannel"><span class="nav-number">2.</span> <span class="nav-text">2. Flannel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Calico"><span class="nav-number">3.</span> <span class="nav-text">3. Calico</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Cilium"><span class="nav-number">4.</span> <span class="nav-text">4. Cilium</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E4%B8%89%E8%80%85%E5%AF%B9%E6%AF%94%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">5. ä¸‰è€…å¯¹æ¯”æ€»ç»“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-CNI-%E7%9A%84%E8%83%8C%E6%99%AF"><span class="nav-number">6.</span> <span class="nav-text">1. CNI çš„èƒŒæ™¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-CNI-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-number">7.</span> <span class="nav-text">2. CNI çš„å·¥ä½œæµç¨‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-CNI-%E6%8F%92%E4%BB%B6%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83"><span class="nav-number">8.</span> <span class="nav-text">3. CNI æ’ä»¶æ¥å£è§„èŒƒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-CNI-%E5%9C%A8-Kubernetes-%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">9.</span> <span class="nav-text">4. CNI åœ¨ Kubernetes ä¸­çš„ä½œç”¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E7%AE%80%E5%8C%96%E5%9B%BE%E7%A4%BA"><span class="nav-number">10.</span> <span class="nav-text">5. ç®€åŒ–å›¾ç¤º</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E8%83%8C%E6%99%AF"><span class="nav-number">11.</span> <span class="nav-text">1. èƒŒæ™¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">12.</span> <span class="nav-text">2. å·¥ä½œåŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-to-Pod-%E9%80%9A%E4%BF%A1"><span class="nav-number">12.1.</span> <span class="nav-text">Pod-to-Pod é€šä¿¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-to-Service-%E9%80%9A%E4%BF%A1"><span class="nav-number">12.2.</span> <span class="nav-text">Pod-to-Service é€šä¿¡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E6%84%8F%EF%BC%9A"><span class="nav-number">12.3.</span> <span class="nav-text">ç®€å•ç¤ºæ„ï¼š</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%A8%A1%E5%BC%8F%E7%89%B9%E7%82%B9"><span class="nav-number">13.</span> <span class="nav-text">3. æ¨¡å¼ç‰¹ç‚¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">14.</span> <span class="nav-text">4. é€‚ç”¨åœºæ™¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F%E5%AF%B9%E6%AF%94"><span class="nav-number">15.</span> <span class="nav-text">5. ä¸å…¶ä»–æ¨¡å¼å¯¹æ¯”</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Native-Routing-eBPF-hostRouting-%E6%A8%A1%E5%BC%8F%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">16.</span> <span class="nav-text">Native Routing + eBPF hostRouting æ¨¡å¼å·¥ä½œåŸç†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cilium-VXLAN-%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">17.</span> <span class="nav-text">Cilium VXLAN æ¨¡å¼çš„å·¥ä½œåŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pod-to-Pod-%E6%B5%81%E9%87%8F"><span class="nav-number">17.1.</span> <span class="nav-text">Pod-to-Pod æµé‡</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">å…­ä¸€</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">273</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/huiaz" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;huiaz" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å…­ä¸€</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">1.7m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">25:34</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body>
</html>

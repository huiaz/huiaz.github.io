<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>è¯ä¹¦æ›´æ–° | Hui's Blog</title><meta name="author" content="å…­ä¸€"><meta name="copyright" content="å…­ä¸€"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æ›´æ–°ä¸€ä¸ª10å¹´æœ‰æ•ˆæœŸçš„ Kubernetes è¯ä¹¦ä½¿ç”¨ kubeadm å®‰è£… kubernetes é›†ç¾¤éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€ä¸ªæ¯”è¾ƒçƒ¦äººçš„é—®é¢˜å°±æ˜¯é»˜è®¤çš„è¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰ä¸€å¹´æ—¶é—´ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘è¯ä¹¦å‡çº§çš„é—®é¢˜ï¼Œæœ¬æ–‡çš„æ¼”ç¤ºé›†ç¾¤ç‰ˆæœ¬ä¸º v1.16.2 ç‰ˆæœ¬ï¼Œä¸ä¿è¯ä¸‹é¢çš„æ“ä½œå¯¹å…¶ä»–ç‰ˆæœ¬ä¹Ÿé€‚ç”¨ï¼Œåœ¨æ“ä½œä¹‹å‰ä¸€å®šè¦å…ˆå¯¹è¯ä¹¦ç›®å½•è¿›è¡Œå¤‡ä»½ï¼Œé˜²æ­¢æ“ä½œé”™è¯¯è¿›è¡Œå›æ»šã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸¤ç§æ–¹å¼æ¥æ›´æ–°é›†ç¾¤è¯ä¹¦ã€‚ æ‰‹åŠ¨æ›´æ–°è¯ä¹¦ç”± kub">
<meta property="og:type" content="article">
<meta property="og:title" content="è¯ä¹¦æ›´æ–°">
<meta property="og:url" content="https://huiaz.github.io/2025/09/11/%E8%AF%81%E4%B9%A6%E6%9B%B4%E6%96%B0/index.html">
<meta property="og:site_name" content="Hui&#39;s Blog">
<meta property="og:description" content="æ›´æ–°ä¸€ä¸ª10å¹´æœ‰æ•ˆæœŸçš„ Kubernetes è¯ä¹¦ä½¿ç”¨ kubeadm å®‰è£… kubernetes é›†ç¾¤éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€ä¸ªæ¯”è¾ƒçƒ¦äººçš„é—®é¢˜å°±æ˜¯é»˜è®¤çš„è¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰ä¸€å¹´æ—¶é—´ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘è¯ä¹¦å‡çº§çš„é—®é¢˜ï¼Œæœ¬æ–‡çš„æ¼”ç¤ºé›†ç¾¤ç‰ˆæœ¬ä¸º v1.16.2 ç‰ˆæœ¬ï¼Œä¸ä¿è¯ä¸‹é¢çš„æ“ä½œå¯¹å…¶ä»–ç‰ˆæœ¬ä¹Ÿé€‚ç”¨ï¼Œåœ¨æ“ä½œä¹‹å‰ä¸€å®šè¦å…ˆå¯¹è¯ä¹¦ç›®å½•è¿›è¡Œå¤‡ä»½ï¼Œé˜²æ­¢æ“ä½œé”™è¯¯è¿›è¡Œå›æ»šã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸¤ç§æ–¹å¼æ¥æ›´æ–°é›†ç¾¤è¯ä¹¦ã€‚ æ‰‹åŠ¨æ›´æ–°è¯ä¹¦ç”± kub">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://huiaz.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-09-11T12:32:34.000Z">
<meta property="article:modified_time" content="2025-09-11T14:20:13.612Z">
<meta property="article:author" content="å…­ä¸€">
<meta property="article:tag" content="è¿ç»´">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://huiaz.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "è¯ä¹¦æ›´æ–°",
  "url": "https://huiaz.github.io/2025/09/11/%E8%AF%81%E4%B9%A6%E6%9B%B4%E6%96%B0/",
  "image": "https://huiaz.github.io/img/butterfly-icon.png",
  "datePublished": "2025-09-11T12:32:34.000Z",
  "dateModified": "2025-09-11T14:20:13.612Z",
  "author": [
    {
      "@type": "Person",
      "name": "å…­ä¸€",
      "url": "https://huiaz.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://huiaz.github.io/2025/09/11/%E8%AF%81%E4%B9%A6%E6%9B%B4%E6%96%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'è¯ä¹¦æ›´æ–°',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">274</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">45</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Hui's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">è¯ä¹¦æ›´æ–°</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">è¯ä¹¦æ›´æ–°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-09-11T12:32:34.000Z" title="å‘è¡¨äº 2025-09-11 20:32:34">2025-09-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-09-11T14:20:13.612Z" title="æ›´æ–°äº 2025-09-11 22:20:13">2025-09-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/k8s/">k8s</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/k8s/%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86/">é›†ç¾¤ç®¡ç†</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="æ›´æ–°ä¸€ä¸ª10å¹´æœ‰æ•ˆæœŸçš„-Kubernetes-è¯ä¹¦"><a href="#æ›´æ–°ä¸€ä¸ª10å¹´æœ‰æ•ˆæœŸçš„-Kubernetes-è¯ä¹¦" class="headerlink" title="æ›´æ–°ä¸€ä¸ª10å¹´æœ‰æ•ˆæœŸçš„ Kubernetes è¯ä¹¦"></a>æ›´æ–°ä¸€ä¸ª10å¹´æœ‰æ•ˆæœŸçš„ Kubernetes è¯ä¹¦</h1><p>ä½¿ç”¨ kubeadm å®‰è£… kubernetes é›†ç¾¤éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€ä¸ªæ¯”è¾ƒçƒ¦äººçš„é—®é¢˜å°±æ˜¯é»˜è®¤çš„è¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰ä¸€å¹´æ—¶é—´ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘è¯ä¹¦å‡çº§çš„é—®é¢˜ï¼Œæœ¬æ–‡çš„æ¼”ç¤ºé›†ç¾¤ç‰ˆæœ¬ä¸º v1.16.2 ç‰ˆæœ¬ï¼Œä¸ä¿è¯ä¸‹é¢çš„æ“ä½œå¯¹å…¶ä»–ç‰ˆæœ¬ä¹Ÿé€‚ç”¨ï¼Œ<strong>åœ¨æ“ä½œä¹‹å‰ä¸€å®šè¦å…ˆå¯¹è¯ä¹¦ç›®å½•è¿›è¡Œå¤‡ä»½ï¼Œé˜²æ­¢æ“ä½œé”™è¯¯è¿›è¡Œå›æ»š</strong>ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸¤ç§æ–¹å¼æ¥æ›´æ–°é›†ç¾¤è¯ä¹¦ã€‚</p>
<h3 id="æ‰‹åŠ¨æ›´æ–°è¯ä¹¦"><a href="#æ‰‹åŠ¨æ›´æ–°è¯ä¹¦" class="headerlink" title="æ‰‹åŠ¨æ›´æ–°è¯ä¹¦"></a>æ‰‹åŠ¨æ›´æ–°è¯ä¹¦</h3><p>ç”± kubeadm ç”Ÿæˆçš„å®¢æˆ·ç«¯è¯ä¹¦é»˜è®¤åªæœ‰ä¸€å¹´æœ‰æ•ˆæœŸï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>check-expiration</code> å‘½ä»¤æ¥æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubeadm alpha certs check-expiration</span></span><br><span class="line">CERTIFICATE                EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED</span><br><span class="line">admin.conf                 Nov 07, 2020 11:59 UTC   73d             no</span><br><span class="line">apiserver                  Nov 07, 2020 11:59 UTC   73d             no</span><br><span class="line">apiserver-etcd-client      Nov 07, 2020 11:59 UTC   73d             no</span><br><span class="line">apiserver-kubelet-client   Nov 07, 2020 11:59 UTC   73d             no</span><br><span class="line">controller-manager.conf    Nov 07, 2020 11:59 UTC   73d             no</span><br><span class="line">etcd-healthcheck-client    Nov 07, 2020 11:59 UTC   73d             no</span><br><span class="line">etcd-peer                  Nov 07, 2020 11:59 UTC   73d             no</span><br><span class="line">etcd-server                Nov 07, 2020 11:59 UTC   73d             no</span><br><span class="line">front-proxy-client         Nov 07, 2020 11:59 UTC   73d             no</span><br><span class="line">scheduler.conf             Nov 07, 2020 11:59 UTC   73d             no</span><br></pre></td></tr></table></figure>

<p>è¯¥å‘½ä»¤æ˜¾ç¤º <code>/etc/kubernetes/pki</code> æ–‡ä»¶å¤¹ä¸­çš„å®¢æˆ·ç«¯è¯ä¹¦ä»¥åŠ kubeadm ä½¿ç”¨çš„ <code>KUBECONFIG</code> æ–‡ä»¶ä¸­åµŒå…¥çš„å®¢æˆ·ç«¯è¯ä¹¦çš„åˆ°æœŸæ—¶é—´&#x2F;å‰©ä½™æ—¶é—´ã€‚</p>
<blockquote>
<p><code>kubeadm</code> ä¸èƒ½ç®¡ç†ç”±å¤–éƒ¨ CA ç­¾åçš„è¯ä¹¦ï¼Œå¦‚æœæ˜¯å¤–éƒ¨å¾—è¯ä¹¦ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨å»ç®¡ç†è¯ä¹¦çš„æ›´æ–°ã€‚</p>
</blockquote>
<p>å¦å¤–éœ€è¦è¯´æ˜çš„æ˜¯ä¸Šé¢çš„åˆ—è¡¨ä¸­æ²¡æœ‰åŒ…å« <code>kubelet.conf</code>ï¼Œå› ä¸º kubeadm å°† kubelet é…ç½®ä¸ºè‡ªåŠ¨æ›´æ–°è¯ä¹¦ã€‚</p>
<p>å¦å¤– kubeadm ä¼šåœ¨æ§åˆ¶é¢æ¿å‡çº§çš„æ—¶å€™è‡ªåŠ¨æ›´æ–°æ‰€æœ‰è¯ä¹¦ï¼Œæ‰€ä»¥ä½¿ç”¨ kubeadm æ­å»ºå¾—é›†ç¾¤æœ€ä½³çš„åšæ³•æ˜¯ç»å¸¸å‡çº§é›†ç¾¤ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„é›†ç¾¤ä¿æŒæœ€æ–°çŠ¶æ€å¹¶ä¿æŒåˆç†çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯å¯¹äºå®é™…çš„ç”Ÿäº§ç¯å¢ƒæˆ‘ä»¬å¯èƒ½å¹¶ä¸ä¼šå»é¢‘ç¹å¾—å‡çº§é›†ç¾¤ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å»æ‰‹åŠ¨æ›´æ–°è¯ä¹¦ã€‚</p>
<p>è¦æ‰‹åŠ¨æ›´æ–°è¯ä¹¦ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ <code>kubeadm alpha certs renew</code> å‘½ä»¤å³å¯æ›´æ–°ä½ çš„è¯ä¹¦ï¼Œè¿™ä¸ªå‘½ä»¤ç”¨ CAï¼ˆæˆ–è€… front-proxy-CA ï¼‰è¯ä¹¦å’Œå­˜å‚¨åœ¨ <code>/etc/kubernetes/pki</code> ä¸­çš„å¯†é’¥æ‰§è¡Œæ›´æ–°ã€‚</p>
<blockquote>
<p>å¦‚æœä½ è¿è¡Œäº†ä¸€ä¸ªé«˜å¯ç”¨çš„é›†ç¾¤ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦åœ¨æ‰€æœ‰æ§åˆ¶é¢æ¿èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚</p>
</blockquote>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ›´æ–°æˆ‘ä»¬çš„é›†ç¾¤è¯ä¹¦ï¼Œä¸‹é¢çš„æ“ä½œéƒ½æ˜¯åœ¨ master èŠ‚ç‚¹ä¸Šè¿›è¡Œï¼Œé¦–å…ˆå¤‡ä»½åŸæœ‰è¯ä¹¦ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> /etc/kubernetes.bak</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> -r /etc/kubernetes/pki/ /etc/kubernetes.bak</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> /etc/kubernetes/*.conf /etc/kubernetes.bak</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¤‡ä»½ etcd æ•°æ®ç›®å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> -r /var/lib/etcd /var/lib/etcd.bak</span></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æ‰§è¡Œæ›´æ–°è¯ä¹¦çš„å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubeadm alpha certs renew all --config=kubeadm.yaml</span></span><br><span class="line">kubeadm alpha certs renew all --config=kubeadm.yaml</span><br><span class="line">certificate embedded in the kubeconfig file for the admin to use and for kubeadm itself renewed</span><br><span class="line">certificate for serving the Kubernetes API renewed</span><br><span class="line">certificate the apiserver uses to access etcd renewed</span><br><span class="line">certificate for the API server to connect to kubelet renewed</span><br><span class="line">certificate embedded in the kubeconfig file for the controller manager to use renewed</span><br><span class="line">certificate for liveness probes to healthcheck etcd renewed</span><br><span class="line">certificate for etcd nodes to communicate with each other renewed</span><br><span class="line">certificate for serving etcd renewed</span><br><span class="line">certificate for the front proxy client renewed</span><br><span class="line">certificate embedded in the kubeconfig file for the scheduler manager to use renewed</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„å‘½ä»¤è¯ä¹¦å°±ä¸€é”®æ›´æ–°å®Œæˆäº†ï¼Œè¿™ä¸ªæ—¶å€™æŸ¥çœ‹ä¸Šé¢çš„è¯ä¹¦å¯ä»¥çœ‹åˆ°è¿‡æœŸæ—¶é—´å·²ç»æ˜¯ä¸€å¹´åçš„æ—¶é—´äº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubeadm alpha certs check-expiration</span></span><br><span class="line">CERTIFICATE                EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED</span><br><span class="line">admin.conf                 Aug 26, 2021 03:47 UTC   364d            no</span><br><span class="line">apiserver                  Aug 26, 2021 03:47 UTC   364d            no</span><br><span class="line">apiserver-etcd-client      Aug 26, 2021 03:47 UTC   364d            no</span><br><span class="line">apiserver-kubelet-client   Aug 26, 2021 03:47 UTC   364d            no</span><br><span class="line">controller-manager.conf    Aug 26, 2021 03:47 UTC   364d            no</span><br><span class="line">etcd-healthcheck-client    Aug 26, 2021 03:47 UTC   364d            no</span><br><span class="line">etcd-peer                  Aug 26, 2021 03:47 UTC   364d            no</span><br><span class="line">etcd-server                Aug 26, 2021 03:47 UTC   364d            no</span><br><span class="line">front-proxy-client         Aug 26, 2021 03:47 UTC   364d            no</span><br><span class="line">scheduler.conf             Aug 26, 2021 03:47 UTC   364d            no</span><br></pre></td></tr></table></figure>

<p>ç„¶åè®°å¾—æ›´æ–°ä¸‹ kubeconfig æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubeadm init phase kubeconfig all --config kubeadm.yaml</span></span><br><span class="line">[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;</span><br><span class="line">[kubeconfig] Using existing kubeconfig file: &quot;/etc/kubernetes/admin.conf&quot;</span><br><span class="line">[kubeconfig] Using existing kubeconfig file: &quot;/etc/kubernetes/kubelet.conf&quot;</span><br><span class="line">[kubeconfig] Using existing kubeconfig file: &quot;/etc/kubernetes/controller-manager.conf&quot;</span><br><span class="line">[kubeconfig] Using existing kubeconfig file: &quot;/etc/kubernetes/scheduler.conf&quot;</span><br></pre></td></tr></table></figure>

<p>å°†æ–°ç”Ÿæˆçš„ admin é…ç½®æ–‡ä»¶è¦†ç›–æ‰åŸæœ¬çš„ admin æ–‡ä»¶:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mv</span> <span class="variable">$HOME</span>/.kube/config <span class="variable">$HOME</span>/.kube/config.old</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span></span><br></pre></td></tr></table></figure>

<p>å®Œæˆåé‡å¯ kube-apiserverã€kube-controllerã€kube-schedulerã€etcd è¿™ 4 ä¸ªå®¹å™¨å³å¯ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ apiserver çš„è¯ä¹¦çš„æœ‰æ•ˆæœŸæ¥éªŒè¯æ˜¯å¦æ›´æ–°æˆåŠŸï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> | openssl s_client -showcerts -connect 127.0.0.1:6443 -servername api 2&gt;/dev/null | openssl x509 -noout -enddate</span></span><br><span class="line">notAfter=Aug 26 03:47:23 2021 GMT</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç°åœ¨çš„æœ‰æ•ˆæœŸæ˜¯ä¸€å¹´è¿‡åçš„ï¼Œè¯æ˜å·²ç»æ›´æ–°æˆåŠŸäº†ã€‚</p>
<h3 id="ç”¨-Kubernetes-è¯ä¹¦-API-æ›´æ–°è¯ä¹¦"><a href="#ç”¨-Kubernetes-è¯ä¹¦-API-æ›´æ–°è¯ä¹¦" class="headerlink" title="ç”¨ Kubernetes è¯ä¹¦ API æ›´æ–°è¯ä¹¦"></a>ç”¨ Kubernetes è¯ä¹¦ API æ›´æ–°è¯ä¹¦</h3><p>é™¤äº†ä¸Šè¿°çš„ä¸€é”®æ‰‹åŠ¨æ›´æ–°è¯ä¹¦ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Kubernetes è¯ä¹¦ API æ‰§è¡Œæ‰‹åŠ¨è¯ä¹¦æ›´æ–°ã€‚å¯¹äºçº¿ä¸Šç¯å¢ƒæˆ‘ä»¬å¯èƒ½å¹¶ä¸ä¼šå»å†’é™©ç»å¸¸æ›´æ–°é›†ç¾¤æˆ–è€…å»æ›´æ–°è¯ä¹¦ï¼Œè¿™äº›æ¯•ç«Ÿæ˜¯æœ‰é£é™©çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›ç”Ÿæˆçš„è¯ä¹¦æœ‰æ•ˆæœŸè¶³å¤Ÿé•¿ï¼Œè™½ç„¶ä»å®‰å…¨æ€§è§’åº¦æ¥è¯´ä¸æ¨èè¿™æ ·åšï¼Œä½†æ˜¯å¯¹äºæŸäº›åœºæ™¯ä¸‹ä¸€ä¸ªè¶³å¤Ÿé•¿çš„è¯ä¹¦æœ‰æ•ˆæœŸä¹Ÿæ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚æœ‰å¾ˆå¤šç®¡ç†å‘˜å°±æ˜¯å»æ‰‹åŠ¨æ›´æ”¹ kubeadm çš„æºç ä¸º 10 å¹´ï¼Œç„¶åé‡æ–°ç¼–è¯‘æ¥åˆ›å»ºé›†ç¾¤ï¼Œè¿™ç§æ–¹å¼è™½ç„¶å¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯ä¸æ¨èä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ æƒ³è¦æ›´æ–°é›†ç¾¤çš„æ—¶å€™ï¼Œè¿˜å¾—ç”¨æ–°ç‰ˆæœ¬è¿›è¡Œæ›´æ–°ã€‚å…¶å® Kubernetes æä¾›äº†ä¸€ç§ API çš„æ–¹å¼å¯ä»¥æ¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªè¶³å¤Ÿé•¿è¯ä¹¦æœ‰æ•ˆæœŸã€‚</p>
<p>è¦ä½¿ç”¨å†…ç½®çš„ API æ–¹å¼æ¥ç­¾åï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦é…ç½® kube-controller-manager ç»„ä»¶çš„ <code>--experimental-cluster-signing-duration</code> å‚æ•°ï¼Œå°†å…¶è°ƒæ•´ä¸º 10 å¹´ï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯ kubeadm å®‰è£…çš„é›†ç¾¤ï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹é™æ€ Pod çš„ yaml æ–‡ä»¶å³å¯:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vi /etc/kubernetes/manifests/kube-controller-manager.yaml</span></span><br><span class="line">......</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - command:</span><br><span class="line">    - kube-controller-manager</span><br><span class="line">    # è®¾ç½®è¯ä¹¦æœ‰æ•ˆæœŸä¸º 10 å¹´</span><br><span class="line">    - --experimental-cluster-signing-duration=87600h</span><br><span class="line">    - --client-ca-file=/etc/kubernetes/pki/ca.crt</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹å®Œæˆå kube-controller-manager ä¼šè‡ªåŠ¨é‡å¯ç”Ÿæ•ˆã€‚ç„¶åæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä¸º Kubernetes è¯ä¹¦ API åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾åè¯·æ±‚ã€‚å¦‚æœæ‚¨è®¾ç½®ä¾‹å¦‚ <code>cert-manager</code> ç­‰å¤–éƒ¨ç­¾åè€…ï¼Œåˆ™ä¼šè‡ªåŠ¨æ‰¹å‡†è¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRsï¼‰ã€‚å¦è€…ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨ <code>kubectl certificate</code> å‘½ä»¤æ‰‹åŠ¨æ‰¹å‡†è¯ä¹¦ã€‚ä»¥ä¸‹ kubeadm å‘½ä»¤è¾“å‡ºè¦æ‰¹å‡†çš„è¯ä¹¦åç§°ï¼Œç„¶åç­‰å¾…æ‰¹å‡†å‘ç”Ÿï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubeadm alpha certs renew all --use-api --config kubeadm.yaml &amp;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1] 2890</span><br><span class="line">[certs] Certificate request &quot;kubeadm-cert-kubernetes-admin-pn99f&quot; created</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å»æ‰‹åŠ¨æ‰¹å‡†è¯ä¹¦ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl get csr</span></span><br><span class="line">NAME                                  AGE   REQUESTOR          CONDITION</span><br><span class="line">kubeadm-cert-kubernetes-admin-pn99f   64s   kubernetes-admin   Pending</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰‹åŠ¨æ‰¹å‡†è¯ä¹¦</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl certificate approve kubeadm-cert-kubernetes-admin-pn99f</span></span><br><span class="line">certificatesigningrequest.certificates.k8s.io/kubeadm-cert-kubernetes-admin-pn99f approved</span><br></pre></td></tr></table></figure>

<p>ç”¨åŒæ ·çš„æ–¹å¼ä¸ºå¤„äº Pending çŠ¶æ€çš„ csr æ‰§è¡Œæ‰¹å‡†æ“ä½œï¼Œç›´åˆ°æ‰€æœ‰çš„ csr éƒ½æ‰¹å‡†å®Œæˆä¸ºæ­¢ã€‚æœ€åæ‰€æœ‰çš„ csr åˆ—è¡¨çŠ¶æ€å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubectl get csr</span></span><br><span class="line">NAME                                                AGE     REQUESTOR          CONDITION</span><br><span class="line">kubeadm-cert-front-proxy-client-llhrj               30s     kubernetes-admin   Approved,Issued</span><br><span class="line">kubeadm-cert-kube-apiserver-2s6kf                   2m43s   kubernetes-admin   Approved,Issued</span><br><span class="line">kubeadm-cert-kube-apiserver-etcd-client-t9pkx       2m7s    kubernetes-admin   Approved,Issued</span><br><span class="line">kubeadm-cert-kube-apiserver-kubelet-client-pjbjm    108s    kubernetes-admin   Approved,Issued</span><br><span class="line">kubeadm-cert-kube-etcd-healthcheck-client-8dcn8     64s     kubernetes-admin   Approved,Issued</span><br><span class="line">kubeadm-cert-kubernetes-admin-pn99f                 4m29s   kubernetes-admin   Approved,Issued</span><br><span class="line">kubeadm-cert-system:kube-controller-manager-mr86h   79s     kubernetes-admin   Approved,Issued</span><br><span class="line">kubeadm-cert-system:kube-scheduler-t8lnw            17s     kubernetes-admin   Approved,Issued</span><br><span class="line">kubeadm-cert-ydzs-master-cqh4s                      52s     kubernetes-admin   Approved,Issued</span><br><span class="line">kubeadm-cert-ydzs-master-lvbr5                      41s     kubernetes-admin   Approved,Issued</span><br></pre></td></tr></table></figure>

<p>æ‰¹å‡†å®Œæˆåæ£€æŸ¥è¯ä¹¦çš„æœ‰æ•ˆæœŸï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kubeadm alpha certs check-expiration</span></span><br><span class="line">CERTIFICATE                EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED</span><br><span class="line">admin.conf                 Nov 05, 2029 11:53 UTC   9y              no</span><br><span class="line">apiserver                  Nov 05, 2029 11:54 UTC   9y              no</span><br><span class="line">apiserver-etcd-client      Nov 05, 2029 11:53 UTC   9y              no</span><br><span class="line">apiserver-kubelet-client   Nov 05, 2029 11:54 UTC   9y              no</span><br><span class="line">controller-manager.conf    Nov 05, 2029 11:54 UTC   9y              no</span><br><span class="line">etcd-healthcheck-client    Nov 05, 2029 11:53 UTC   9y              no</span><br><span class="line">etcd-peer                  Nov 05, 2029 11:53 UTC   9y              no</span><br><span class="line">etcd-server                Nov 05, 2029 11:54 UTC   9y              no</span><br><span class="line">front-proxy-client         Nov 05, 2029 11:54 UTC   9y              no</span><br><span class="line">scheduler.conf             Nov 05, 2029 11:53 UTC   9y              no</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»å»¶é•¿å° 10 å¹´äº†ï¼Œè¿™æ˜¯å› ä¸º ca è¯ä¹¦çš„æœ‰æ•ˆæœŸåªæœ‰ 10 å¹´ã€‚</p>
<p>ä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿˜ä¸èƒ½ç›´æ¥é‡å¯æ§åˆ¶é¢æ¿çš„å‡ ä¸ªç»„ä»¶ï¼Œè¿™æ˜¯å› ä¸ºä½¿ç”¨ kubeadm å®‰è£…çš„é›†ç¾¤å¯¹åº”çš„ etcd é»˜è®¤æ˜¯ä½¿ç”¨çš„ <code>/etc/kubernetes/pki/etcd/ca.crt</code> è¿™ä¸ªè¯ä¹¦è¿›è¡Œå‰é¢çš„ï¼Œè€Œä¸Šé¢æˆ‘ä»¬ç”¨å‘½ä»¤ <code>kubectl certificate approve</code> æ‰¹å‡†è¿‡åçš„è¯ä¹¦æ˜¯ä½¿ç”¨çš„é»˜è®¤çš„ <code>/etc/kubernetes/pki/ca.crt</code> è¯ä¹¦è¿›è¡Œç­¾å‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›¿æ¢ etcd ä¸­çš„ ca æœºæ„è¯ä¹¦:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…ˆæ‹·è´é™æ€ Pod èµ„æºæ¸…å•</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> -r /etc/kubernetes/manifests/ /etc/kubernetes/manifests.bak</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vi /etc/kubernetes/manifests/etcd.yaml</span></span><br><span class="line">......</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - command:</span><br><span class="line">    - etcd</span><br><span class="line">    # ä¿®æ”¹ä¸º CA æ–‡ä»¶</span><br><span class="line">    - --peer-trusted-ca-file=/etc/kubernetes/pki/ca.crt</span><br><span class="line">    - --trusted-ca-file=/etc/kubernetes/pki/ca.crt</span><br><span class="line">......</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - mountPath: /var/lib/etcd</span><br><span class="line">      name: etcd-data</span><br><span class="line">    - mountPath: /etc/kubernetes/pki  # æ›´æ”¹è¯ä¹¦ç›®å½•</span><br><span class="line">      name: etcd-certs</span><br><span class="line">  volumes:</span><br><span class="line">  - hostPath:</span><br><span class="line">      path: /etc/kubernetes/pki  # å°† pki ç›®å½•æŒ‚è½½åˆ° etcd ä¸­å»</span><br><span class="line">      type: DirectoryOrCreate</span><br><span class="line">    name: etcd-certs</span><br><span class="line">  - hostPath:</span><br><span class="line">      path: /var/lib/etcd</span><br><span class="line">      type: DirectoryOrCreate</span><br><span class="line">    name: etcd-data</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>ç”±äº kube-apiserver è¦è¿æ¥ etcd é›†ç¾¤ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦é‡æ–°ä¿®æ”¹å¯¹åº”çš„ etcd ca æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vi /etc/kubernetes/manifests/kube-apiserver.yaml</span></span><br><span class="line">......</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - command:</span><br><span class="line">    - kube-apiserver</span><br><span class="line">    # å°†etcd caæ–‡ä»¶ä¿®æ”¹ä¸ºé»˜è®¤çš„ca.crtæ–‡ä»¶</span><br><span class="line">    - --etcd-cafile=/etc/kubernetes/pki/ca.crt</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–è¿˜éœ€è¦æ›¿æ¢ <code>requestheader-client-ca-file</code> æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ <code>/etc/kubernetes/pki/front-proxy-ca.crt</code> æ–‡ä»¶ï¼Œç°åœ¨ä¹Ÿéœ€è¦æ›¿æ¢æˆé»˜è®¤çš„ CA æ–‡ä»¶ï¼Œå¦åˆ™ä½¿ç”¨èšåˆ APIï¼Œæ¯”å¦‚å®‰è£…äº† metrics-server åæ‰§è¡Œ <code>kubectl top</code> å‘½ä»¤å°±ä¼šæŠ¥é”™ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> /etc/kubernetes/pki/ca.crt /etc/kubernetes/pki/front-proxy-ca.crt</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> /etc/kubernetes/pki/ca.key /etc/kubernetes/pki/front-proxy-ca.key</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºæ˜¯é™æ€ Podï¼Œä¿®æ”¹å®Œæˆåä¸Šé¢çš„ç»„ä»¶éƒ½ä¼šè‡ªåŠ¨é‡å¯ç”Ÿæ•ˆã€‚ç”±äºæˆ‘ä»¬å½“å‰ç‰ˆæœ¬çš„ kubelet é»˜è®¤å¼€å¯äº†è¯ä¹¦è‡ªåŠ¨è½®è½¬ï¼Œæ‰€ä»¥ kubelet çš„è¯ä¹¦ä¹Ÿä¸ç”¨å†å»ç®¡ç†äº†ï¼Œè¿™æ ·æˆ‘å°±å°†è¯ä¹¦æ›´æ–°æˆ 10 æœ‰æ•ˆæœŸäº†ã€‚<strong>åœ¨æ“ä½œä¹‹å‰ä¸€å®šè¦å…ˆå¯¹è¯ä¹¦ç›®å½•è¿›è¡Œå¤‡ä»½ï¼Œé˜²æ­¢æ“ä½œé”™è¯¯è¿›è¡Œå›æ»š</strong>ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://huiaz.github.io">å…­ä¸€</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://huiaz.github.io/2025/09/11/%E8%AF%81%E4%B9%A6%E6%9B%B4%E6%96%B0/">https://huiaz.github.io/2025/09/11/%E8%AF%81%E4%B9%A6%E6%9B%B4%E6%96%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://huiaz.github.io" target="_blank">Hui's Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%BF%90%E7%BB%B4/">è¿ç»´</a><a class="post-meta__tags" href="/tags/k8s/">k8s</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/09/11/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" title="è´Ÿè½½å‡è¡¡"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">è´Ÿè½½å‡è¡¡</div></div><div class="info-2"><div class="info-item-1">ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼ˆLoad Balancingï¼‰ï¼Ÿåœ¨ Web æœåŠ¡å™¨ç¯å¢ƒä¸­ï¼Œè´Ÿè½½å‡è¡¡æ˜¯ä¸€ç§å°†ç½‘ç»œè¯·æ±‚ï¼ˆæµé‡ï¼‰æœ‰æ•ˆåœ°åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼ˆé€šå¸¸ç§°ä¸ºåç«¯æœåŠ¡å™¨æˆ–ä¸Šæ¸¸æœåŠ¡å™¨ï¼‰ä¸Šçš„æŠ€æœ¯ã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š  æé«˜ç³»ç»Ÿå¯ç”¨æ€§ï¼š å½“æŸå°åç«¯æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶ï¼Œè´Ÿè½½å‡è¡¡å™¨å¯ä»¥å°†æµé‡è‡ªåŠ¨è·¯ç”±åˆ°å¥åº·çš„æœåŠ¡å™¨ï¼Œé¿å…æœåŠ¡ä¸­æ–­ã€‚ æé«˜ç³»ç»Ÿæ€§èƒ½ï¼š é€šè¿‡å°†è¯·æ±‚åˆ†æ•£åˆ°å¤šå°æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥é¿å…å•å°æœåŠ¡å™¨è¿‡è½½ï¼Œç¼©çŸ­å“åº”æ—¶é—´ï¼Œæé«˜å¤„ç†èƒ½åŠ›ã€‚ æé«˜ç³»ç»Ÿå¯ä¼¸ç¼©æ€§ï¼š éšç€ä¸šåŠ¡å¢é•¿ï¼Œå¯ä»¥é€šè¿‡ç®€å•åœ°å¢åŠ åç«¯æœåŠ¡å™¨æ¥æ‰©å±•ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œè€Œæ— éœ€å‡çº§å•å°æœåŠ¡å™¨ã€‚ ä¼˜åŒ–èµ„æºåˆ©ç”¨ï¼š ç¡®ä¿æ‰€æœ‰åç«¯æœåŠ¡å™¨éƒ½èƒ½å¾—åˆ°åˆç†çš„åˆ©ç”¨ï¼Œè€Œä¸æ˜¯æŸäº›æœåŠ¡å™¨ç©ºé—²è€Œå¦ä¸€äº›è¿‡è½½ã€‚  ç®€å•æ¥è¯´ï¼Œè´Ÿè½½å‡è¡¡å™¨å°±åƒä¸€ä¸ªäº¤é€šæŒ‡æŒ¥å®˜ï¼Œå®ƒæ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œä¸ä¼šè®©è¯·æ±‚ç›´æ¥å»æŸä¸€å°å…·ä½“çš„æœåŠ¡å™¨ï¼Œè€Œæ˜¯æ ¹æ®é¢„è®¾çš„ç®—æ³•å’Œè§„åˆ™ï¼Œå°†å…¶å¯¼å‘å½“å‰æœ€åˆé€‚ï¼ˆæˆ–ä¸‹ä¸€ä¸ªï¼‰çš„åç«¯æœåŠ¡å™¨å»å¤„ç†ï¼Œå¹¶å°†å¤„ç†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ è´Ÿè½½å‡è¡¡çš„å¸¸è§ç®—æ³•è´Ÿè½½å‡è¡¡å™¨ä¼šæ ¹æ®ä¸åŒçš„ç®—æ³•æ¥å†³å®šå°†è¯·æ±‚åˆ†å‘ç»™å“ªå°åç«¯æœåŠ¡å™¨ã€‚Nginx æ”¯æŒå¤šç§ç®—æ³•ï¼š  è½®è¯¢ (Round Robin)ï¼š åŸç†ï¼š é»˜è®¤ç®—æ³•ã€‚è¯·æ±‚æŒ‰æ—¶é—´é¡ºåºä¾æ¬¡åˆ†å‘åˆ°åç«¯æœåŠ¡...</div></div></div></a><a class="pagination-related" href="/2025/09/11/%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" title="è®¿é—®æ§åˆ¶"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">è®¿é—®æ§åˆ¶</div></div><div class="info-2"><div class="info-item-1">å¥½çš„ï¼Œä½œä¸ºä¸€åè¿ç»´å·¥ç¨‹å¸ˆï¼Œæˆ‘æ¥è¯¦ç»†æè¿°åœ¨ Nginx ä¸­å¦‚ä½•é…ç½®è®¿é—®æ§åˆ¶ï¼Œå¹¶æä¾›å…·ä½“çš„é…ç½®ç¤ºä¾‹ã€‚ è®¿é—®æ§åˆ¶æ˜¯ä¿éšœ Web åº”ç”¨å®‰å…¨çš„é‡è¦ä¸€ç¯ï¼ŒNginx æä¾›äº†å¤šç§çµæ´»çš„æ–¹å¼æ¥å®ç°å¯¹èµ„æºçš„è®¿é—®é™åˆ¶ï¼ŒåŒ…æ‹¬åŸºäº IP åœ°å€çš„è®¿é—®æ§åˆ¶ã€åŸºäºç”¨æˆ·è®¤è¯çš„è®¿é—®æ§åˆ¶ä»¥åŠç»“åˆä¸¤è€…ä½¿ç”¨ã€‚ Nginx è®¿é—®æ§åˆ¶çš„ç±»å‹Nginx ä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¿›è¡Œè®¿é—®æ§åˆ¶ï¼š  åŸºäº IP åœ°å€çš„è®¿é—®æ§åˆ¶ (Allow&#x2F;Deny)ï¼š æ ¹æ®å®¢æˆ·ç«¯çš„ IP åœ°å€åˆ¤æ–­æ˜¯å¦å…è®¸è®¿é—®ã€‚ åŸºäºç”¨æˆ·è®¤è¯çš„è®¿é—®æ§åˆ¶ (HTTP Basic Authentication)ï¼š è¦æ±‚ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç æ‰èƒ½è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚  è¿˜æœ‰ä¸€äº›é«˜çº§çš„è®¿é—®æ§åˆ¶ï¼Œä¾‹å¦‚åŸºäº JWT éªŒè¯ï¼ˆéœ€è¦ Lua æ¨¡å—æˆ–å…¶ä»–å®šåˆ¶å¼€å‘ï¼‰ï¼Œæˆ–è€…ä¸ç¬¬ä¸‰æ–¹è®¤è¯æœåŠ¡é›†æˆï¼Œä½†æœ€å¸¸ç”¨å’ŒåŸºç¡€çš„å°±æ˜¯ä¸Šè¿°ä¸¤ç§ã€‚  1. åŸºäº IP åœ°å€çš„è®¿é—®æ§åˆ¶ (Allow&#x2F;Deny)è¿™æ˜¯æœ€ç›´æ¥çš„è®¿é—®æ§åˆ¶æ–¹å¼ï¼Œé€‚ç”¨äºé™åˆ¶ç‰¹å®š IP åœ°å€æˆ– IP æ®µçš„è®¿é—®ã€‚ æŒ‡ä»¤ï¼š  allow address | CIDR | all;ï¼šå…è®¸æŒ‡å®šçš„ IP åœ°å€ã€IP æ®µæˆ–æ‰€æœ‰ IP è®¿é—®ã€‚...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/09/11/Pod%20%E8%B0%83%E5%BA%A6/" title="Pod è°ƒåº¦"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">Pod è°ƒåº¦</div></div><div class="info-2"><div class="info-item-1">è°ƒåº¦ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ¨ç½²çš„ Pod æ˜¯é€šè¿‡é›†ç¾¤çš„è‡ªåŠ¨è°ƒåº¦ç­–ç•¥æ¥é€‰æ‹©èŠ‚ç‚¹çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹è°ƒåº¦å™¨è€ƒè™‘çš„æ˜¯èµ„æºè¶³å¤Ÿï¼Œå¹¶ä¸”è´Ÿè½½å°½é‡å¹³å‡ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿæ›´åŠ ç»†ç²’åº¦çš„å»æ§åˆ¶ Pod çš„è°ƒåº¦ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›ä¸€äº›æœºå™¨å­¦ä¹ çš„åº”ç”¨åªè·‘åœ¨æœ‰ GPU çš„èŠ‚ç‚¹ä¸Šï¼›ä½†æ˜¯æœ‰çš„æ—¶å€™æˆ‘ä»¬çš„æœåŠ¡ä¹‹é—´äº¤æµæ¯”è¾ƒé¢‘ç¹ï¼Œåˆå¸Œæœ›èƒ½å¤Ÿå°†è¿™æœåŠ¡çš„ Pod éƒ½è°ƒåº¦åˆ°åŒä¸€ä¸ªçš„èŠ‚ç‚¹ä¸Šã€‚è¿™å°±éœ€è¦ä½¿ç”¨ä¸€äº›è°ƒåº¦æ–¹å¼æ¥æ§åˆ¶ Pod çš„è°ƒåº¦äº†ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼šäº²å’Œæ€§å’Œåäº²å’Œæ€§ï¼Œäº²å’Œæ€§åˆåˆ†æˆèŠ‚ç‚¹äº²å’Œæ€§(nodeAffinity)å’Œ Pod äº²å’Œæ€§(podAffinity)ã€‚ nodeSelectoråœ¨äº†è§£äº²å’Œæ€§ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„è°ƒåº¦æ–¹å¼ï¼šnodeSelectorã€‚æˆ‘ä»¬çŸ¥é“ label æ ‡ç­¾æ˜¯ kubernetes ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œç”¨æˆ·å¯ä»¥éå¸¸çµæ´»çš„åˆ©ç”¨ label æ¥ç®¡ç†é›†ç¾¤ä¸­çš„èµ„æºï¼Œæ¯”å¦‚æœ€å¸¸è§çš„ Service å¯¹è±¡é€šè¿‡ label å»åŒ¹é… Pod èµ„æºï¼Œè€Œ Pod çš„è°ƒåº¦ä¹Ÿå¯ä»¥æ ¹æ®èŠ‚ç‚¹çš„ label æ¥è¿›è¡Œè°ƒåº¦ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æˆ‘ä»¬çš„ node çš„ labelï¼š 12345âœ kubectl get nod...</div></div></div></a><a class="pagination-related" href="/2025/09/11/Dockerfile%20%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" title="Dockerfile æœ€ä½³å®è·µ"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">Dockerfile æœ€ä½³å®è·µ</div></div><div class="info-2"><div class="info-item-1">Dockerfile æœ€ä½³å®è·µDockerå®˜æ–¹å…³äºDockerfileæœ€ä½³å®è·µåŸæ–‡é“¾æ¥åœ°å€ï¼šhttps://docs.docker.com/develop/develop-images/dockerfile_best-practices/ Dockerå¯ä»¥é€šè¿‡ä»DockerfileåŒ…å«æ‰€æœ‰å‘½ä»¤çš„æ–‡æœ¬æ–‡ä»¶ä¸­è¯»å–æŒ‡ä»¤è‡ªåŠ¨æ„å»ºé•œåƒï¼Œä»¥ä¾¿æ„å»ºç»™å®šé•œåƒã€‚ Dockerfilesä½¿ç”¨ç‰¹å®šçš„æ ¼å¼å¹¶ä½¿ç”¨ä¸€ç»„ç‰¹å®šçš„æŒ‡ä»¤ã€‚æ‚¨å¯ä»¥åœ¨ Dockerfile Reference é¡µé¢ä¸Šäº†è§£åŸºç¡€çŸ¥è¯† ã€‚å¦‚æœä½ æ˜¯æ–°æ‰‹å†™ä½œDockerfileï¼Œä½ åº”è¯¥ä»é‚£é‡Œå¼€å§‹ã€‚ æœ¬æ–‡æ¡£ä»‹ç»äº†ç”± Dockerï¼ŒInc. å’Œ Docker ç¤¾åŒºæ¨èçš„ç”¨äºæ„å»ºé«˜æ•ˆé•œåƒçš„æœ€ä½³å®è·µå’Œæ–¹æ³•ã€‚è¦æŸ¥çœ‹æ›´å¤šå®è·µå’Œå»ºè®®ï¼Œè¯·æŸ¥çœ‹ Dockerfile for buildpack-depsã€‚ ä¸€èˆ¬å‡†åˆ™å’Œå»ºè®®å®¹å™¨åº”è¯¥æ˜¯çŸ­æš‚çš„é€šè¿‡ Dockerfile æ„å»ºçš„é•œåƒæ‰€å¯åŠ¨çš„å®¹å™¨åº”è¯¥å°½å¯èƒ½çŸ­æš‚ï¼ˆç”Ÿå‘½å‘¨æœŸçŸ­ï¼‰ã€‚ã€ŒçŸ­æš‚ã€æ„å‘³ç€å¯ä»¥åœæ­¢å’Œé”€æ¯å®¹å™¨ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨å¹¶éƒ¨ç½²å¥½æ‰€éœ€çš„è®¾ç½®å’Œé…ç½®å·¥ä½œé‡åº”è¯¥æ˜¯æå°çš„ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸‹12 Factor(12è¦ç´ )åº”ç”¨ç¨‹åºæ–¹æ³•...</div></div></div></a><a class="pagination-related" href="/2025/09/11/k8s%20Logs/" title="k8s Logs"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">k8s Logs</div></div><div class="info-2"><div class="info-item-1">æè¿°åœ¨ Kubernetes ä¸­å¦‚ä½•è¿›è¡Œæ—¥å¿—ç®¡ç†ï¼Œå¹¶è§£é‡Šå¸¸ç”¨çš„æ–¹æ³•ã€‚ Of course. Log management is a cornerstone of observability in any production system, and Kubernetes presents unique challenges and solutions. This is a great question to assess a candidateâ€™s operational maturity. ğŸ¤” åˆ†æè¿‡ç¨‹ï¼šè¯¥é—®é¢˜æ—¨åœ¨è€ƒå¯Ÿå¯¹Kubernetesä¸­æ—¥å¿—ç”Ÿå‘½å‘¨æœŸå’Œé›†ä¸­å¼æ—¥å¿—è§£å†³æ–¹æ¡ˆçš„ç†è§£ã€‚ä¸€ä¸ªå…¨é¢çš„å›ç­”éœ€è¦é¦–å…ˆè§£é‡Šä¸ºä»€ä¹ˆåŸºç¡€çš„kubectl logså‘½ä»¤åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸è¶³å¤Ÿï¼Œä»è€Œå¼•å‡ºé›†ä¸­å¼æ—¥å¿—ç®¡ç†çš„éœ€æ±‚ã€‚æ¥ç€ï¼Œéœ€è¦æ¸…æ™°åœ°æè¿°æœ€ä¸»æµçš„å®ç°æ¶æ„ï¼ˆèŠ‚ç‚¹çº§æ—¥å¿—ä»£ç†ï¼‰ï¼Œå¹¶èƒ½è§£é‡Šå…¶å·¥ä½œæµç¨‹ã€‚æåŠSidecaræ¨¡å¼ä½œä¸ºè¡¥å……æ–¹æ¡ˆï¼Œä»¥åŠä»‹ç»å¸‚é¢ä¸Šæµè¡Œçš„å·¥å…·æ ˆï¼ˆå¦‚EFKã€PLGï¼‰ï¼Œå¯ä»¥å……åˆ†å±•ç°é¢è¯•è€…åœ¨è¯¥é¢†åŸŸçš„çŸ¥è¯†å¹¿åº¦å’Œæ·±åº¦ã€‚ ğŸ’¡ ç­”æ¡ˆç”Ÿæˆï¼š1. æ¦‚å¿µæˆ–å®šä¹‰Kubernetesæ—¥å¿—ç®¡ç†æ˜¯æŒ‡ä¸€å¥—ç³»ç»Ÿæ€§çš„æ–¹æ³•...</div></div></div></a><a class="pagination-related" href="/2025/09/11/%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7/" title="å®¹å™¨ç›‘æ§"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">å®¹å™¨ç›‘æ§</div></div><div class="info-2"><div class="info-item-1">å®¹å™¨ç›‘æ§è¯´åˆ°å®¹å™¨ç›‘æ§æˆ‘ä»¬è‡ªç„¶ä¼šæƒ³åˆ° cAdvisorï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿè¯´è¿‡ cAdvisor å·²ç»å†…ç½®åœ¨äº† kubelet ç»„ä»¶ä¹‹ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å•ç‹¬å»å®‰è£…ï¼ŒcAdvisor çš„æ•°æ®è·¯å¾„ä¸º /api/v1/nodes/&lt;node&gt;/proxy/metricsï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æ¨èä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå› ä¸ºè¿™ç§æ–¹å¼æ˜¯é€šè¿‡ APIServer å»ä»£ç†è®¿é—®çš„ï¼Œå¯¹äºå¤§è§„æ¨¡çš„é›†ç¾¤ä¼šå¯¹ APIServer é€ æˆå¾ˆå¤§çš„å‹åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡è®¿é—® kubelet çš„ /metrics/cadvisor è¿™ä¸ªç«¯ç‚¹æ¥è·å– cAdvisor çš„æ•°æ®ã€‚ cAdvisoræˆ‘ä»¬è¿™é‡Œä½¿ç”¨ node çš„æœåŠ¡å‘ç°æ¨¡å¼ï¼Œå› ä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸‹é¢éƒ½æœ‰ kubeletï¼Œè‡ªç„¶éƒ½æœ‰ cAdvisor é‡‡é›†åˆ°çš„æ•°æ®æŒ‡æ ‡ï¼Œé…ç½®å¦‚ä¸‹ï¼š 12345678910111213141516171819- job_name: &#x27;cadvisor&#x27;  kubernetes_sd_configs:    - role: node  scheme: https  tls_config:    ca_file: /var/run/se...</div></div></div></a><a class="pagination-related" href="/2025/09/11/Thanos%20Receiver/" title="Thanos Receiver"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">Thanos Receiver</div></div><div class="info-2"><div class="info-item-1">Receiverå‰é¢æˆ‘ä»¬æåˆ° Thanos æœ‰ Sidecar å’Œ Receiver ä¸¤ç§ä¸åŒçš„æ¶æ„æ¨¡å¼ï¼Œå‰é¢çš„ç« èŠ‚æˆ‘ä»¬å·²ç»å­¦ä¹ äº† Sidecar æ¨¡å¼çš„æ˜¯å‘€ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥äº†è§£ä¸‹ Receiver æ¨¡å¼æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æˆ‘ä»¬çŸ¥é“ Sidecar æ˜¯åœ¨æ¯ä¸€ä¸ª Prometheus çš„å®ä¾‹æ—è¾¹æ·»åŠ ä¸€ä¸ª sidecar ç»„ä»¶æ¥ä¸Šä¼ æ•°æ®ï¼Œä½†æ˜¯æ•°æ®ä¸Šä¼ å¹¶ä¸æ˜¯å®æ—¶çš„ï¼Œè€Œæ˜¯æ¯ 2h ä¸Šä¼ ä¸€ä¸ªæ•°æ®å—ï¼Œæ‰€ä»¥è¿œç¨‹å­˜å‚¨çš„æ•°æ®å¹¶ä¸æ˜¯å®æ—¶çš„ï¼ŒPrometheus éœ€è¦å„è‡ªæŒä¹…åŒ–éƒ¨åˆ†æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯ç°åœ¨ä½¿ç”¨çš„ Sidecar æ¨¡å¼çš„å¼Šç«¯ï¼Œä½†è¿™å¹¶éæ˜¯ Thanos å›¢é˜Ÿå¼•å…¥ Receiver çš„å†³å®šæ€§å› ç´ ã€‚  Receiver is only recommended for uses for whom pushing is the only viable solution, for example, analytics use cases or cases where the data ingestion must be client initiated, such as software as a servic...</div></div></div></a><a class="pagination-related" href="/2025/09/11/Kubernetes%20%E7%AE%80%E4%BB%8B/" title="Kubernetes ç®€ä»‹"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">Kubernetes ç®€ä»‹</div></div><div class="info-2"><div class="info-item-1">Kubernetes ç®€ä»‹Kubernetesï¼ˆç®€ç§° K8Sï¼‰ çš„å‡ºç°æ˜¯å®¹å™¨åŒ–æŠ€æœ¯å‘å±•çš„å¿…ç„¶ç»“æœï¼Œå®¹å™¨åŒ–æ˜¯åº”ç”¨ç¨‹åºçº§åˆ«çš„è™šæ‹ŸåŒ–ï¼Œè¿è¡Œå•ä¸ªå†…æ ¸ä¸Šæœ‰å¤šä¸ªç‹¬ç«‹çš„ç”¨æˆ·ç©ºé—´å®ä¾‹ï¼Œè¿™äº›å®ä¾‹å°±æ˜¯å®¹å™¨ï¼›å®¹å™¨æä¾›äº†å°†åº”ç”¨ç¨‹åºçš„ä»£ç ã€è¿è¡Œæ—¶ã€ç³»ç»Ÿå·¥å…·ã€ç³»ç»Ÿåº“å’Œé…ç½®æ‰“åŒ…åˆ°ä¸€ä¸ªå®ä¾‹ä¸­çš„æ ‡å‡†æ–¹æ³•ï¼Œè€Œä¸”å®¹å™¨æ˜¯å…±äº«ä¸€ä¸ªå†…æ ¸çš„ï¼›ç”±äºå®¹å™¨æŠ€æœ¯çš„å…´èµ·ï¼Œå¯¼è‡´å¤§é‡çš„å®¹å™¨åº”ç”¨å‡ºç°ï¼Œæ‰€ä»¥å°±å‡ºç°äº†ä¸€äº›ç”¨æ¥æ”¯æŒåº”ç”¨ç¨‹åºå®¹å™¨åŒ–éƒ¨ç½²å’Œç»„ç»‡çš„å®¹å™¨ç¼–æ’æŠ€æœ¯ï¼Œä¸€äº›æµè¡Œçš„å¼€æºå®¹å™¨ç¼–æ’å·¥å…·æœ‰ Docker Swarmã€Kubernetes ç­‰ï¼Œä½†æ˜¯åœ¨å‘å±•è¿‡ç¨‹ä¸­ Kubernetes ç°åœ¨å·²ç»æˆä¸ºäº†å®¹å™¨ç¼–æ’é¢†åŸŸäº‹å®ä¸Šçš„ä¸€ä¸ªæ ‡å‡†äº†ã€‚  Kubernetes æ˜¯ Google å›¢é˜Ÿå‘èµ·çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒçš„ç›®æ ‡æ˜¯ç®¡ç†è·¨å¤šä¸ªä¸»æœºçš„å®¹å™¨ï¼Œç”¨äºè‡ªåŠ¨éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºï¼Œä¸»è¦å®ç°è¯­è¨€ä¸º Go è¯­è¨€ï¼Œä»–çš„ç†è®ºåŸºç¡€æ¥æºä¸ Google å†…éƒ¨çš„ Borg é¡¹ç›®ï¼Œæ‰€ä»¥ Kubernetes é¡¹ç›®çš„ç†è®ºåŸºç¡€å°±æ¯”å…¶ä»–å¼€æºé¡¹ç›®è¦â€œå…ˆè¿›â€å¾ˆå¤šï¼Œå› ä¸º Borg ç³»ç»Ÿä¸€ç›´ä¾èµ–å°±è¢«ç§°ä¸º Google å…¬å¸å†…éƒ¨æœ€å¼ºå¤§çš„â€œç§å¯†æ­¦å™¨â€ã€‚ æ¶æ„Kubernetes é¡¹ç›®ä¾æ‰˜...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">å…­ä¸€</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">274</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">45</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E4%B8%80%E4%B8%AA10%E5%B9%B4%E6%9C%89%E6%95%88%E6%9C%9F%E7%9A%84-Kubernetes-%E8%AF%81%E4%B9%A6"><span class="toc-number">1.</span> <span class="toc-text">æ›´æ–°ä¸€ä¸ª10å¹´æœ‰æ•ˆæœŸçš„ Kubernetes è¯ä¹¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6"><span class="toc-number">1.0.1.</span> <span class="toc-text">æ‰‹åŠ¨æ›´æ–°è¯ä¹¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8-Kubernetes-%E8%AF%81%E4%B9%A6-API-%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6"><span class="toc-number">1.0.2.</span> <span class="toc-text">ç”¨ Kubernetes è¯ä¹¦ API æ›´æ–°è¯ä¹¦</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/27/hexo-beautify/" title="Hexo åšå®¢ç¾åŒ–ç¬”è®°ï¼šä»é›¶æ­å»ºé«˜é¢œå€¼æŠ€æœ¯åšå®¢">Hexo åšå®¢ç¾åŒ–ç¬”è®°ï¼šä»é›¶æ­å»ºé«˜é¢œå€¼æŠ€æœ¯åšå®¢</a><time datetime="2026-02-27T04:00:00.000Z" title="å‘è¡¨äº 2026-02-27 12:00:00">2026-02-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/Jenkens-Blue%20Ocean%20%E6%8F%92%E4%BB%B6/" title="Jenkins Blue Ocean">Jenkins Blue Ocean</a><time datetime="2025-09-11T12:42:57.000Z" title="å‘è¡¨äº 2025-09-11 20:42:57">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/jenkins-jenkinsfile/" title="Jenkins Jenkinsfile">Jenkins Jenkinsfile</a><time datetime="2025-09-11T12:40:44.000Z" title="å‘è¡¨äº 2025-09-11 20:40:44">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/shell-trap/" title="Linux-trap">Linux-trap</a><time datetime="2025-09-11T12:40:44.000Z" title="å‘è¡¨äº 2025-09-11 20:40:44">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/shell-%E6%95%B0%E7%BB%84/" title="Shell-æ•°ç»„">Shell-æ•°ç»„</a><time datetime="2025-09-11T12:40:44.000Z" title="å‘è¡¨äº 2025-09-11 20:40:44">2025-09-11</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By å…­ä¸€</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body></html>
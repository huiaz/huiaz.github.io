<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Ansible基础架构 | Hui's Blog</title><meta name="author" content="六一"><meta name="copyright" content="六一"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Ansible 基础架构Ansible 的架构非常简洁和优雅，这是它广受欢迎的关键原因之一。其核心理念是 “无客户端”（Agentless）。 其架构主要由以下几个部分组成：  控制节点 (Control Node)  定义： 任何安装了 Ansible 的机器都可以作为控制节点。你就是在这个节点上编写和执行 Ansible 命令和 Playbook 的。 要求： 通常是一台 Linux 或 m">
<meta property="og:type" content="article">
<meta property="og:title" content="Ansible基础架构">
<meta property="og:url" content="https://huiaz.github.io/2025/09/11/ansible/index.html">
<meta property="og:site_name" content="Hui&#39;s Blog">
<meta property="og:description" content="Ansible 基础架构Ansible 的架构非常简洁和优雅，这是它广受欢迎的关键原因之一。其核心理念是 “无客户端”（Agentless）。 其架构主要由以下几个部分组成：  控制节点 (Control Node)  定义： 任何安装了 Ansible 的机器都可以作为控制节点。你就是在这个节点上编写和执行 Ansible 命令和 Playbook 的。 要求： 通常是一台 Linux 或 m">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://huiaz.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-09-11T12:32:34.000Z">
<meta property="article:modified_time" content="2025-09-11T14:24:21.217Z">
<meta property="article:author" content="六一">
<meta property="article:tag" content="运维">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://huiaz.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Ansible基础架构",
  "url": "https://huiaz.github.io/2025/09/11/ansible/",
  "image": "https://huiaz.github.io/img/butterfly-icon.png",
  "datePublished": "2025-09-11T12:32:34.000Z",
  "dateModified": "2025-09-11T14:24:21.217Z",
  "author": [
    {
      "@type": "Person",
      "name": "六一",
      "url": "https://huiaz.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://huiaz.github.io/2025/09/11/ansible/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Ansible基础架构',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">274</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">45</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Hui's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Ansible基础架构</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Ansible基础架构</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-11T12:32:34.000Z" title="发表于 2025-09-11 20:32:34">2025-09-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-11T14:24:21.217Z" title="更新于 2025-09-11 22:24:21">2025-09-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/Ansible/">Ansible</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><hr>
<h3 id="Ansible-基础架构"><a href="#Ansible-基础架构" class="headerlink" title="Ansible 基础架构"></a>Ansible 基础架构</h3><p>Ansible 的架构非常简洁和优雅，这是它广受欢迎的关键原因之一。其核心理念是 <strong>“无客户端”（Agentless）</strong>。</p>
<p>其架构主要由以下几个部分组成：</p>
<ol>
<li><p><strong>控制节点 (Control Node)</strong></p>
<ul>
<li><strong>定义：</strong> 任何安装了 Ansible 的机器都可以作为控制节点。你就是在这个节点上编写和执行 Ansible 命令和 Playbook 的。</li>
<li><strong>要求：</strong> 通常是一台 Linux 或 macOS 系统（Windows 可以通过 WSL 使用）。需要安装 Python。</li>
<li><strong>功能：</strong><ul>
<li>管理整个自动化任务的执行。</li>
<li>存储 Inventory、Playbooks 和 Roles。</li>
<li>通过 SSH（默认）或 WinRM（用于 Windows）连接到受管节点。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>受管节点 (Managed Nodes &#x2F; Target Hosts)</strong></p>
<ul>
<li><strong>定义：</strong> 被 Ansible 管理和配置的服务器或网络设备。这些是你希望执行自动化任务的目标机器。</li>
<li><strong>要求：</strong><ul>
<li><strong>Linux&#x2F;Unix 系统：</strong> 只需要 SSH 服务和 Python 环境。Ansible 会自动推送并执行所需的 Python 模块，然后删除，完全<strong>无需安装任何 Agent</strong>。</li>
<li><strong>Windows 系统：</strong> 需要开启 WinRM 服务，Ansible 通过它进行通信。</li>
</ul>
</li>
<li><strong>特点：</strong> 保持”干净”，无需维护额外的客户端软件，极大地降低了管理的复杂性和安全风险。</li>
</ul>
</li>
<li><p><strong>Inventory（资产清单）</strong></p>
<ul>
<li><strong>定义：</strong> 一个描述受管节点信息的文件。它告诉 Ansible，“你的管辖范围是哪些机器”。</li>
<li><strong>格式：</strong> 通常是 INI 或 YAML 格式。</li>
<li><strong>功能：</strong><ul>
<li>列出所有受管主机的 IP 地址或主机名。</li>
<li>对主机进行**分组 (groups)**，比如 <code>[webservers]</code>、<code>[databases]</code>。这使得你可以针对特定的一组机器执行任务。</li>
<li>可以定义主机变量（如特定主机的 SSH 端口、用户名）和组变量（如 <code>webservers</code> 组通用的配置参数）。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Modules（模块）</strong></p>
<ul>
<li><strong>定义：</strong> Ansible 的<strong>“工具箱”</strong>。每个模块都是一个独立的小程序，负责执行一个特定的任务，比如安装软件包 (<code>yum</code>&#x2F;<code>apt</code> 模块)、管理服务 (<code>service</code> 模块)、操作文件 (<code>copy</code>&#x2F;<code>file</code> 模块)等。</li>
<li><strong>特点：</strong><ul>
<li>Ansible 拥有数千个内置模块，覆盖了系统管理、云服务、网络设备等几乎所有场景。</li>
<li><strong>幂等性 (Idempotency)</strong> 是大多数模块的核心特性。这意味着一个操作执行一次和执行多次的效果是相同的。例如，用 <code>service</code> 模块确保一个服务是“启动”状态，如果它已经启动了，Ansible 就不会做任何事；如果没启动，才会去启动它。这让自动化任务非常安全和可预测。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Playbooks（剧本）</strong></p>
<ul>
<li><strong>定义：</strong> Ansible 的<strong>“编排语言”</strong>和<strong>“任务蓝图”</strong>。它是一个 YAML 格式的文件，用来定义一系列有序的任务（Tasks），以及这些任务应该在哪些主机上执行。</li>
<li><strong>功能：</strong><ul>
<li><strong>定义一个或多个“剧目 (Plays)”：</strong> 每个 Play 将一组主机（通过 <code>hosts:</code> 关键字指定）与一系列任务绑定。</li>
<li><strong>调用模块：</strong> 每个任务（Task）本质上就是对一个模块的调用。</li>
<li><strong>逻辑控制：</strong> 支持变量、循环、条件判断，以及通过 Handlers 实现事件驱动（如“配置文件变更后重启服务”）。</li>
<li><strong>编排复杂的流程：</strong> 可以定义多阶段、跨多组主机的复杂部署和配置流程。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Plugins（插件）</strong></p>
<ul>
<li><strong>定义：</strong> 用于扩展 Ansible 核心功能的代码。</li>
<li><strong>类型：</strong> 包括回调插件（<code>callback plugins</code>，用于自定义输出）、连接插件（<code>connection plugins</code>，如 <code>docker</code> 连接）等，提供了强大的扩展能力。</li>
</ul>
</li>
</ol>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p>Ansible 的工作流程非常直观，可以分解为以下几个步骤：</p>
<ol>
<li><p><strong>解析命令&#x2F;Playbook：</strong></p>
<ul>
<li>用户在<strong>控制节点</strong>上执行一个 <code>ansible</code> 命令（用于临时任务）或 <code>ansible-playbook</code> 命令。</li>
<li>Ansible 首先会读取并解析指定的 Playbook（YAML 文件）。</li>
</ul>
</li>
<li><p><strong>读取 Inventory：</strong></p>
<ul>
<li>Ansible 根据 Playbook 中 <code>hosts:</code> 指令或命令行参数，去 Inventory 文件中查找目标主机。它会识别出所有匹配的主机 IP、分组和相关变量。</li>
</ul>
</li>
<li><p><strong>建立连接：</strong></p>
<ul>
<li>Ansible 通过 SSH（默认）或指定的连接插件，尝试与每一个目标<strong>受管节点</strong>建立连接。它会使用 Inventory 中定义的用户、密码或 SSH 密钥进行认证。</li>
</ul>
</li>
<li><p><strong>推送并执行模块：</strong></p>
<ul>
<li>这是 <strong>Agentless</strong> 的核心所在。对于每一个在 Playbook 中定义的 Task：<ul>
<li>Ansible 在控制节点上找到该任务所需的<strong>模块</strong>（一个 Python 文件）和参数。</li>
<li>它会将这个模块文件以及相关参数打包成一个临时的 Python 脚本。</li>
<li>通过已建立的 SSH 连接，将这个<strong>临时的 Python 脚本上传</strong>到受管节点的临时目录中（如 <code>~/.ansible/tmp/</code>）。</li>
<li>在受管节点上，通过 SSH <strong>执行这个 Python 脚本</strong> (<code>python /path/to/tmp/script.py</code>)。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>模块执行与返回结果：</strong></p>
<ul>
<li>在受管节点上，这个临时脚本开始执行真正的任务（比如调用 <code>yum</code> 命令）。</li>
<li>执行完成后，脚本会以 <strong>JSON 格式</strong>输出结果（包括是否成功、是否有变更、详细信息等）。</li>
<li>Ansible 在控制节点上通过 SSH 捕获这个 JSON 输出。</li>
</ul>
</li>
<li><p><strong>清理临时文件：</strong></p>
<ul>
<li>任务执行完毕后，Ansible 会自动删除在受管节点上创建的那个<strong>临时 Python 脚本</strong>。这就是为什么受管节点上不需要安装任何常驻进程的原因——它只是在需要时“借用”一下 Python 解释器。</li>
</ul>
</li>
<li><p><strong>处理结果与反馈：</strong></p>
<ul>
<li>控制节点解析收到的 JSON 结果，并根据结果更新任务状态（<code>ok</code>, <code>changed</code>, <code>failed</code>）。</li>
<li>它将结果输出到用户的终端，并根据 Playbook 的逻辑继续执行下一个任务、处理 Handler，或在失败时中止。</li>
</ul>
</li>
</ol>
<p>整个过程周而复始，直到 Playbook 中的所有任务都执行完毕。这种简单、安全且强大的工作模式，使其成为运维自动化领域的首选工具。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://huiaz.github.io">六一</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://huiaz.github.io/2025/09/11/ansible/">https://huiaz.github.io/2025/09/11/ansible/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://huiaz.github.io" target="_blank">Hui's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%BF%90%E7%BB%B4/">运维</a><a class="post-meta__tags" href="/tags/Python/">Python</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/09/11/byte/" title="byte"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">byte</div></div><div class="info-2"><div class="info-item-1">rune 和 byte   核心区别：代表的“单位”不同简洁地说：  byte 代表一个字节 (8 bits)。 rune 代表一个 Unicode 码点（即一个字符）。   详细解析1. byte 类型 底层类型： byte 是 uint8 的别名。 1type byte = uint8 这意味着 byte 类型就是一个无符号的 8 位整型，其值范围是 0 到 255。  代表意义：  一个字节： 它是计算机内存中可寻址的最小单位。 原始数据： byte 通常用于处理原始的二进制数据流，比如网络传输中的数据包、文件内容、图片数据等。 ASCII 字符： 对于 ASCII 字符集（英文字母、数字、常见符号），一个字符恰好占用一个字节，所以 byte 也可以表示这些单一字节的字符。   Go 字符串与 byte：  在 Go 语言中，**字符串的底层是 UTF-8 编码的字节序列([]byte)**。len(someString) 返回的是字符串的字节数，而不是字符数。 当你直接对字符串进行索引访问时（如 s[0]），你得到的是一个 byte 值，代表该索引位置的原始字节。 当使用...</div></div></div></a><a class="pagination-related" href="/2025/09/11/Thanos%20Store/" title="Thanos Store"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Thanos Store</div></div><div class="info-2"><div class="info-item-1">Store 组件上面我们安装了 Thanos 的 Sidecar 和 Querier 组件，已经可以做到 Prometheus 的高可用，通过 Querier 提供一个统一的入口来查询监控数据，而且还可以对监控数据自动去重，但是还有一个非常重要的地方是还没有配置对象存储，如果想要查看历史监控数据就不行了，这个时候我们就需要去配置 Thanos Store 组件，将历史监控指标存储在对象存储中去。 目前 Thanos 支持的对象存储有：  要在生产环境使用最好使用 Stable 状态的，比如 S3 或者兼容 S3 的服务，比如 Ceph、Minio 等等。 对于国内用户当然最方便的还是直接使用阿里云 OSS 或者腾讯云 COS 这样的服务，但是很多时候可能我们的服务并不是跑在公有云上面的，所以这里我们用 Minio 来部署一个兼容 S3 协议的对象存储服务。 安装 MinioMinIO 是一个基于 Apache License v2.0 开源协议的高性能分布式对象存储服务，为大规模私有云基础设施而设计。它兼容亚马逊 S3 云存储服务接口，非常适合于存储大容量非结构化的数据，例如图片...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/09/11/python-%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD/" title="python-增量备份"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">python-增量备份</div></div><div class="info-2"><div class="info-item-1">Python 实现的、生产级别的文件增量备份脚本。这个方案的核心是基于文件大小（偏移量）进行追踪，这对于 append-only（只追加写入）的文件（如日志）来说是最高效的。 核心机制 状态追踪文件（State File）: 我们需要一个地方记录上次备份到了源文件的哪个位置。最简单可靠的方法就是创建一个与备份文件关联的状态文件（例如 my_app.log.state），里面只存一个数字：上次备份完成时源文件的字节大小（offset）。 备份逻辑: 首次运行: 状态文件不存在。脚本会从头（偏移量 0）开始，完整备份整个源文件，然后将源文件的当前大小写入状态文件。 后续运行: 脚本首先读取状态文件，获取上次备份的偏移量 last_offset。 然后获取源文件当前的实际大小 current_size。 情况 A (文件增长): 如果 current_size &gt; last_offset，说明有新内容。脚本会打开源文件，将文件指针移动（seek）到 last_offset，然后读取从该位置到文件末尾的所有新数据，并将其追加（append）到备份文件中。成功后，更新状态文件为 cu...</div></div></div></a><a class="pagination-related" href="/2025/09/11/ansible-install-mysql/" title="Ansible"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">Ansible</div></div><div class="info-2"><div class="info-item-1"> name: Install and Configure MySQL Serverhosts: databases  # 针对 inventory 文件中 [databases] 组的主机执行become: yes       # 提权至 root 用户执行任务，因为安装软件需要管理员权限 vars: 使用变量可以轻松适应不同操作系统，例如 CentOS 可能叫 ‘mariadb-server’  mysql_package_name: mysql-server  mysql_service_name: mysql tasks:  name: Update APT cache (for Debian&#x2F;Ubuntu)ansible.builtin.apt:  update_cache: yes  cache_valid_time: 3600 # 缓存有效期1小时when: ansible_os_family &#x3D;&#x3D; “Debian” # 条件判断：仅在 Debian 系系统上执行  name: Install MySQL Packageansible.b...</div></div></div></a><a class="pagination-related" href="/2025/09/11/python%20thread/" title="python thread"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">python thread</div></div><div class="info-2"><div class="info-item-1">Python 多线程然而，在使用之前，必须理解一个核心概念：**Python 的全局解释器锁 (Global Interpreter Lock - GIL)**。  GIL 的影响：GIL 保证了在任何时刻，只有一个线程在执行 Python 字节码。这意味着，如果你的任务是 CPU 密集型的（例如，复杂的数学计算、视频编码），多线程无法利用多核 CPU 来实现真正的并行计算，效率提升不大甚至可能下降。 多线程的优势所在：对于 I&#x2F;O 密集型任务（例如，网络请求、读写文件、数据库查询），一个线程在等待 I&#x2F;O 操作（比如等待网络响应）时，会被阻塞。GIL 在此时会释放，允许另一个线程运行。这样，多个线程可以“轮流”执行，当一个在等待时，另一个在工作，从而极大地减少了总的等待时间，提升了脚本的整体执行效率。  结论先行：在 Python 中，多线程是优化 I&#x2F;O 密集型任务的利器。  如何使用多线程：从基础到最佳实践我们以一个常见的运维场景为例：检查一组服务器的网站是否能正常访问。 场景1：单线程（串行执行）这是未使用多线程的原始脚本，它会一个接一个地检...</div></div></div></a><a class="pagination-related" href="/2025/09/11/Linux%20%E7%B3%BB%E7%BB%9F%20lsof%20%E5%91%BD%E4%BB%A4/" title="Linux 系统 lsof 命令"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">Linux 系统 lsof 命令</div></div><div class="info-2"><div class="info-item-1">lsof（list open files）命令是排查Linux系统中各种“文件占用”问题的利器。在Linux中，“一切皆文件”，这意味着进程不仅打开普通文件（如文本文件、二进制文件），还可能打开目录、网络套接字（sockets）、管道（pipes）、设备文件（如磁盘、终端）、以及共享库等。当我们需要定位某个文件为什么不能被删除、某个端口为何被占用、或者某个进程占用了大量资源时，lsof 都能提供至关重要的信息。  一、lsof 简介 功能： 列出当前系统打开文件的进程信息。 原理： lsof 通过读取内核信息来确定哪些进程正在持有哪些文件描述符。 应用场景： 文件无法删除&#x2F;卸载： 某个文件或目录被进程占用，无法删除或卸载其所在文件系统。 端口占用： 某个端口被未知进程监听或占用，导致新服务无法启动。 磁盘空间报警： 某个被删除的文件仍然占用磁盘空间（因为其句柄仍被进程持有）。 进程资源分析： 查看特定进程打开了哪些文件，评估其资源使用情况。 网络连接故障： 检查哪些进程在进行网络通信。    注意： 运行 lsof 通常需要 root 权限才能查看所有进程打开的文件。 ...</div></div></div></a><a class="pagination-related" href="/2025/09/11/Consule%20%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0/" title="Consule 服务发现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">Consule 服务发现</div></div><div class="info-2"><div class="info-item-1">基于 Consul 的服务发现Consul 是由 HashiCorp 开发的一个支持多数据中心的分布式服务发现和键值对存储服务的开源软件，是一个通用的服务发现和注册中心工具，被大量应用于基于微服务的软件架构当中。 接下来我们就来尝试使用 Prometheus 基于 Consul 的服务发现来监控前面的 3 个 demo 服务： 123192.168.31.46:10000192.168.31.46:10001192.168.31.46:10002  我们将 demo 服务注册到 Consul，然后配置 Prometheus 从 Consul 中发现演示服务实例，并使用 Relabeling 操作来过滤调整目标标签。关于 Consul 本身的使用可以查看官方文档 https://learn.hashicorp.com/consul 了解更多。  安装配置 Consul在页面 https://www.consul.io/downloads 下载符合自己系统的安装文件，比如我们这里是 Linux 系统，使用下面命令下载安装即可： 12345678☸ ➜ wget https://rel...</div></div></div></a><a class="pagination-related" href="/2025/09/11/LInux%20%E5%AE%89%E5%85%A8/" title="LInux 安全"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-11</div><div class="info-item-2">LInux 安全</div></div><div class="info-2"><div class="info-item-1">常见的网络攻击类型1. CC 攻击 (Challenge Collapsar)CC 攻击 是 应用层攻击 的一种，主要针对 Web 服务器的 应用层，通过模拟大量真实用户访问行为，耗尽服务器的处理资源。它的目标是让网站无法正常响应合法用户的请求。 攻击原理：CC 攻击通常会伪造大量的 IP 地址，向目标网站的同一个页面或多个页面发送大量合法的 HTTP 请求。这些请求通常是动态页面（如登录页面、搜索页面、提交表单页面等），因为动态页面的处理需要服务器执行复杂的计算、查询数据库、调用后端程序，这会消耗大量的 CPU、内存和数据库资源。  模拟真实用户行为： 攻击者会模拟用户的 GET 或 POST 请求，可能包括浏览器头、Referer 等信息，使得这些请求看起来像是正常的访问。 高并发请求： 在短时间内发送海量的请求，使服务器的连接数、并发处理能力达到上限。 耗尽服务器资源： 导致服务器处理请求队列堆积，CPU 负载过高，内存耗尽，数据库连接池饱和，最终表现为网站响应缓慢或直接崩溃，无法服务正常用户。  特点：  隐蔽性相对较高： 请求包本身是合法的 HTTP 请求，难以通过简单...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">六一</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">274</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">45</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/huiaz"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ansible-%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">Ansible 基础架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">工作原理</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/02/27/hexo-beautify/" title="Hexo 博客美化笔记：从零搭建高颜值技术博客">Hexo 博客美化笔记：从零搭建高颜值技术博客</a><time datetime="2026-02-27T04:00:00.000Z" title="发表于 2026-02-27 12:00:00">2026-02-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/Jenkens-Blue%20Ocean%20%E6%8F%92%E4%BB%B6/" title="Jenkins Blue Ocean">Jenkins Blue Ocean</a><time datetime="2025-09-11T12:42:57.000Z" title="发表于 2025-09-11 20:42:57">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/jenkins-jenkinsfile/" title="Jenkins Jenkinsfile">Jenkins Jenkinsfile</a><time datetime="2025-09-11T12:40:44.000Z" title="发表于 2025-09-11 20:40:44">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/shell-trap/" title="Linux-trap">Linux-trap</a><time datetime="2025-09-11T12:40:44.000Z" title="发表于 2025-09-11 20:40:44">2025-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/shell-%E6%95%B0%E7%BB%84/" title="Shell-数组">Shell-数组</a><time datetime="2025-09-11T12:40:44.000Z" title="发表于 2025-09-11 20:40:44">2025-09-11</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By 六一</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body></html>